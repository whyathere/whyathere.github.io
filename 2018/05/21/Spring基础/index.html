<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Spring," />










<meta name="description" content="抄自：Iteye开涛博客 http://jinnianshilongnian.iteye.com/category/206533?page=2  Spring概述Spring是什么？Spring是一个开源的轻量级Java SE（Java 标准版本）/JavaEE（Java 企业版本）开发应用框架，其目的是用于简化企业级应用程序开发。应用程序是由一组相互协作的对象组成。而在传统应用程序开发中，一个完">
<meta name="keywords" content="Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring">
<meta property="og:url" content="http://yoursite.com/2018/05/21/Spring基础/index.html">
<meta property="og:site_name" content="Bill">
<meta property="og:description" content="抄自：Iteye开涛博客 http://jinnianshilongnian.iteye.com/category/206533?page=2  Spring概述Spring是什么？Spring是一个开源的轻量级Java SE（Java 标准版本）/JavaEE（Java 企业版本）开发应用框架，其目的是用于简化企业级应用程序开发。应用程序是由一组相互协作的对象组成。而在传统应用程序开发中，一个完">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E7%BE%8E%E5%9B%BE/7.jpg?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/Spring%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.jpg?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E4%BC%A0%E7%BB%9F%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.jpg?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/IoCDI%E5%AE%B9%E5%99%A8%E5%90%8E%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/SpringIoC%E5%AE%B9%E5%99%A8.jpg?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8F%82%E6%95%B0%E7%B4%A2%E5%BC%95%E6%B3%A8%E5%85%A5.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E7%B1%BB%E5%9E%8B%E6%B3%A8%E5%85%A5.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8F%82%E6%95%B0%E5%90%8D%E6%B3%A8%E5%85%A5.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/setter%E6%B3%A8%E5%85%A5.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/setter%E6%B3%A8%E5%85%A52.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%B3%A8%E5%85%A5list.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%B3%A8%E5%85%A5%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%B3%A8%E5%85%A5%E5%AD%97%E5%85%B8.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/properties%E6%B3%A8%E5%85%A5.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/properties%E6%B3%A8%E5%85%A52.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A52.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-setter%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-propertie%E5%AD%90%E6%A0%87%E7%AD%BE.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/ref%20local%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/ref%20parent.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%86%85%E9%83%A8bean.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%A4%84%E7%90%86null.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8D%95%E4%BE%8B%E5%A4%84%E7%90%86.JPG?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8E%9F%E5%9E%8B%E5%A4%84%E7%90%86.JPG?raw=true">
<meta property="og:updated_time" content="2018-09-10T08:30:00.925Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring">
<meta name="twitter:description" content="抄自：Iteye开涛博客 http://jinnianshilongnian.iteye.com/category/206533?page=2  Spring概述Spring是什么？Spring是一个开源的轻量级Java SE（Java 标准版本）/JavaEE（Java 企业版本）开发应用框架，其目的是用于简化企业级应用程序开发。应用程序是由一组相互协作的对象组成。而在传统应用程序开发中，一个完">
<meta name="twitter:image" content="https://github.com/whyathere/tuchuang/blob/master/%E7%BE%8E%E5%9B%BE/7.jpg?raw=true">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/05/21/Spring基础/"/>





  <title>Spring | Bill</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bill</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/21/Spring基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bill">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-21T19:37:39+08:00">
                2018-05-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/框架/" itemprop="url" rel="index">
                    <span itemprop="name">框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>抄自：Iteye开涛博客 <a href="http://jinnianshilongnian.iteye.com/category/206533?page=2" target="_blank" rel="noopener">http://jinnianshilongnian.iteye.com/category/206533?page=2</a></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E7%BE%8E%E5%9B%BE/7.jpg?raw=true" alt=""></p>
<h3 id="Spring概述"><a href="#Spring概述" class="headerlink" title="Spring概述"></a>Spring概述</h3><h4 id="Spring是什么？"><a href="#Spring是什么？" class="headerlink" title="Spring是什么？"></a>Spring是什么？</h4><p>Spring是一个开源的轻量级Java SE（Java 标准版本）/JavaEE（Java 企业版本）开发应用框架，其目的是用于简化企业级应用程序开发。应用程序是由一组相互协作的对象组成。而在传统应用程序开发中，一个完整的应用是由一组相互协作的对象组成。所以开发一个应用除了要开发业务逻辑之外，最多的是关注如何使这些对象协作来完成所需功能，而且要低耦合、高内聚。业务逻辑开发是不可避免的，那如果有个框架出来帮我们来创建对象及管理这些对象之间的依赖关系。可能有人说了，比如“抽象工厂、工厂方法设计模式”不也可以帮我们创建对象，“生成器模式”帮我们处理对象间的依赖关系，不也能完成这些功能吗？可是这些又需要我们创建另一些工厂类、生成器类，我们又要另外管理这些类，增加了我们的负担，如果能有种通过配置方式来创建对象，管理对象之间依赖关系，我们不需要通过工厂和生成器来创建及管理对象之间的依赖关系，这样我们是不是减少了许多工作，加速了开发，能节省出很多时间来干其他事。Spring框架刚出来时主要就是来完成这个功能。<br>Spring框架除了帮我们管理对象及其依赖关系，还提供像通用日志记录、性能统计、安全控制、异常处理等面向切面的能力，还能帮我管理最头疼的数据库事务，本身提供了一套简单的JDBC访问实现，提供与第三方数据访问框架集成（如Hibernate、JPA），与各种Java EE技术整合（如Java Mail、任务调度等等），提供一套自己的web层框架Spring MVC、而且还能非常简单的与第三方web框架集成。从这里我们可以认为Spring是一个超级粘合平台，除了自己提供功能外，还提供粘合其他技术和框架的能力，从而使我们可以更自由的选择到底使用什么技术进行开发。而且不管是JAVA SE（C/S架构）应用程序还是JAVA EE（B/S架构）应用程序都可以使用这个平台进行开发。让我们来深入看一下Spring到底能帮我们做些什么？</p>
<h4 id="Spring能帮我们做什么"><a href="#Spring能帮我们做什么" class="headerlink" title="Spring能帮我们做什么"></a>Spring能帮我们做什么</h4><p>Spring除了不能帮我们写业务逻辑，其余的几乎什么都能帮助我们简化开发：</p>
<p>一、传统程序开发，创建对象及组装对象间依赖关系由我们在程序内部进行控制，这样会加大各个对象间的耦合，如果我们要修改对象间的依赖关系就必须修改源代码，重新编译、部署；而如果采用Spring，则由Spring根据配置文件来进行创建及组装对象间依赖关系，只需要修改配置文件即可，无需重新编译。所以，<strong>Spring能帮我们根据配置文件创建及组装对象之间的依赖关系。</strong></p>
<p>二、当我们要进行一些日志记录、权限控制、性能统计等时，在传统应用程序当中我们可能在需要的对象或方法中进行，而且比如权限控制、性能统计大部分是重复的，这样代码中就存在大量重复代码，即使有人说我把通用部分提取出来，那必然存在调用还是存在重复，像性能统计我们可能只是在必要时才进行，在诊断完毕后要删除这些代码；还有日志记录，比如记录一些方法访问日志、数据访问日志等等，这些都会渗透到各个要访问方法中；还有权限控制，必须在方法执行开始进行审核，想想这些是多么可怕而且是多么无聊的工作。如果采用Spring，这些日志记录、权限控制、性能统计从业务逻辑中分离出来，通过Spring支持的面向切面编程，在需要这些功能的地方动态添加这些功能，无需渗透到各个需要的方法或对象中；有人可能说了，我们可以使用”代理设计模式”或”包装器设计模式”，你可以使用这些，但是还是需要通过编程方式来完成上述功能，一般通过配置方式，而且不需要在现有代码中添加任何额外代码，现有代码专注业务逻辑。所以，<strong>Spring面向切面编程能帮助我们无耦合的实现日志记录，性能统计，安全控制。</strong></p>
<p>三、在传统应用程序当中，我们如何来完成数据库事务管理？需要一系列“获取连接，执行SQL，提交或回滚事务，关闭连接”，而且还要保证在最后一定要关闭连接，多么可怕的事情，而且也很无聊；如果采用Spring，我们只需获取连接，执行SQL，其他的都交给Spring来管理了，简单吧。所以，<strong>Spring能非常简单的帮我们管理数据库事务。</strong></p>
<p>四、Spring还提供了与第三方数据访问框架（如Hibernate、JPA）无缝集成，而且自己也提供了一套JDBC访问模板，来方便数据库访问。</p>
<p>五、Spring还提供与第三方Web（如Struts、JSF）框架无缝集成，而且自己也提供了一套Spring MVC框架，来方便web层搭建。</p>
<p>六、Spring能方便的与Java EE（如Java Mail、任务调度）整合，与更多技术整合（比如缓存框架）。</p>
<p>Spring能帮我们做这么多事情，提供这么多功能和与那么多主流技术整合，而且是帮我们做了开发中比较头疼和困难的事情，那可能有人会问，难道只有Spring这一个框架，没有其他选择？当然有，比如EJB需要依赖应用服务器、开发效率低、在开发中小型项目是宰鸡拿牛刀，虽然发展到现在EJB比较好用了，但还是比较笨重还需要依赖应用服务器等。那为何需要使用Spring，而不是其他框架呢？让我们接着往下看。</p>
<h4 id="为何需要Spring？"><a href="#为何需要Spring？" class="headerlink" title="为何需要Spring？"></a>为何需要Spring？</h4><p>一、首先阐述几个概念</p>
<p><strong>1、应用程序：</strong>是能完成我们所需功能的成品，比如购物网站、OA系统。</p>
<p><strong>2、框架：</strong>是能完成一定功能的半成品，比如我们可以使用框架进行购物网站开发；框架做一部分功能，我们自己做一部分功能，这样应用程序就常见出来了。而且框架规定了你在开发应用程序时的整体框架，提供了一些基础功能，还规定了类和对象的如何创建、如何协作等，从而简化我们开发，让我们专注于业务逻辑开发。</p>
<p><strong>3、非侵入式设计：</strong>从框架角度可以这样理解，无需继承框架提供的类，这种设计就可以看作是非侵入式设计，如果继承了这些框架类，就是侵入设计，如果以后想更换框架之前写过的代码几乎无法重用，如果非侵入式设计则之前写过的代码仍然可以继续使用。</p>
<p><strong>4、轻量级及重量级：</strong>轻量级是相对于重量级而言的，轻量级一般就是非入侵性的、所依赖的东西非常少、资源占用非常少、部署简单等等，其实就是比较容易使用，而重量级正好相反。</p>
<p><strong>5、POJO：</strong>POJO（Plain Old Java Objects）简单的Java对象，它可以包含业务逻辑或持久化逻辑，但不担当任何特殊角色且不继承或不实现任何其它Java框架的类或接口。</p>
<p><strong>6、容器：</strong>在日常生活中容器就是一种盛放东西的器具，从程序设计角度看就是<strong>装对象的的对象</strong>，因为存在放入、拿出等操作，所以容器还要管理对象的生命周期。</p>
<p><strong>7、控制反转：</strong>即Inversion of Control，缩写为IoC，控制反转还有一个名字叫做依赖注入（Dependency Injection），就是由容器控制程序之间的关系，而非传统实现中，由程序代码直接操控。</p>
<p><strong>8、Bean：</strong>一般指容器管理对象，在Spring中指Spring IoC容器管理对象。</p>
<p>二 为什么需要Spring及Spring的优点</p>
<ul>
<li><strong>非常轻量级的容器：</strong>以集中的、自动化的方式进行应用程序对象创建和装配，负责对象创建和装配，管理对象生命周期，能组合成复杂的应用程序。Spring容器是非侵入式的（不需要依赖任何Spring特定类），而且完全采用POJOs进行开发，使应用程序更容易测试、更容易管理。而且核心JAR包非常小，Spring 3.0.5不到1M，而且不需要依赖任何应用服务器，可以部署在任何环境（Java SE或Java EE）。</li>
<li><strong>AOP：</strong>AOP是Aspect Oriented Programming的缩写，意思是面向切面编程，提供从另一个角度来考虑程序结构以完善面向对象编程（相对于OOP），即可以通过在编译期间、装载期间或运行期间实现在不修改源代码的情况下给程序动态添加功能的一种技术。通俗点说就是把可重用的功能提取出来，然后将这些通用功能在合适的时候织入到应用程序中；比如安全，日记记录，这些都是通用的功能，我们可以把它们提取出来，然后在程序执行的合适地方织入这些代码并执行它们，从而完成需要的功能并复用了这些功能。</li>
<li><strong>简单的数据库事务管理：</strong>在使用数据库的应用程序当中，自己管理数据库事务是一项很让人头疼的事，而且很容易出现错误，Spring支持可插入的事务管理支持，而且无需JEE环境支持，通过Spring管理事务可以把我们从事务管理中解放出来来专注业务逻辑。</li>
<li><strong>JDBC抽象及ORM框架支持：</strong>Spring使JDBC更加容易使用；提供DAO（数据访问对象）支持，非常方便集成第三方ORM框架，比如Hibernate等；并且完全支持Spring事务和使用Spring提供的一致的异常体系。</li>
<li><strong>灵活的Web层支持：</strong>Spring本身提供一套非常强大的MVC框架，而且可以非常容易的与第三方MVC框架集成，比如Struts等。</li>
<li>简化各种技术集成：提供对Java Mail、任务调度、JMX、JMS、JNDI、EJB、动态语言、远程访问、Web Service等的集成。</li>
</ul>
<p>Spring能帮助我们简化应用程序开发，帮助我们创建和组装对象，为我们管理事务，简单的MVC框架，可以把Spring看作是一个超级粘合平台，能把很多技术整合在一起，形成一个整体，使系统结构更优良、性能更出众，从而加速我们程序开发，有如上优点，我们没有理由不考虑使用它。</p>
<h4 id="如何学好Spring？"><a href="#如何学好Spring？" class="headerlink" title="如何学好Spring？"></a>如何学好Spring？</h4><p>要学好Spring，首先要明确Spring是个什么东西，能帮我们做些什么事情，知道了这些然后做个简单的例子，这样就基本知道怎么使用Spring了。Spring核心是IoC容器，所以一定要透彻理解什么是IoC容器，以及如何配置及使用容器，其他所有技术都是基于容器实现的；理解好IoC后，接下来是面向切面编程，首先还是明确概念，基本配置，最后是实现原理，接下来就是数据库事务管理，其实Spring管理事务是通过面向切面编程实现的，所以基础很重要，IoC容器和面向切面编程搞定后，其余都是基于这俩东西的实现，学起来就更加轻松了。要学好Spring不能急，一定要把基础打牢，基础牢固了，这就是磨刀不误砍柴工。</p>
<h4 id="Spring基础"><a href="#Spring基础" class="headerlink" title="Spring基础"></a>Spring基础</h4><p><strong>Spring架构图</strong></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/Spring%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg?raw=true" alt=""></p>
<p><strong>核心容器：</strong>包括Core、Beans、Context、EL模块。</p>
<ul>
<li><strong>Core模块：</strong>封装了框架依赖的最底层部分，包括资源访问、类型转换及一些常用工具类。</li>
<li><strong>Beans模块：</strong>提供了框架的基础部分，包括反转控制和依赖注入。其中Bean Factory是容器核心，本质是“工厂设计模式”的实现，而且无需编程实现”单例设计模式”，单例完全由容器控制，而且提倡面向接口编程，而非面向实现编程；所有应用程序对象及对象间关系由框架管理，从而真正把你从程序逻辑中把维护对象之间的依赖关系提取出来，所有这些依赖关系都由BeanFactory来维护。</li>
<li><strong>Context模块：</strong>以Core和Beans为基础，集成Beans 模块功能并添加资源绑定、数据验证、国际化、Java EE支持、容器声明周期、事件传播等；核心接口是ApplicationContext。</li>
<li><strong>EL模块：</strong>提供强大的表达式语言支持，支持访问和修改属性值，方法调用，支持访问及修改数组、容器和索引器，命名变量，支持算数和逻辑运算，支持从Spring容器获取Bean，它也支持列表投影、选择和一般的列表聚合等。</li>
</ul>
<p><strong>AOP、Aspects模块：</strong></p>
<ul>
<li><strong>AOP模块：</strong>Spring AOP 模块提供了符合 AOP Alliance规范的面向方面的编程(aspect-oriented programming) 实现，提供比如日志记录、权限控制、性能统计等通用功能和业务逻辑分离的技术，并且能动态的把这些功能添加到需要的代码中；这样各专其职，降低业务逻辑和通用功能的耦合。</li>
<li><strong>Aspects模块：</strong>提供了对AspectJ 的集成，AspectJ 提供了比 Spring AOP 更强大的功能。</li>
</ul>
<p><strong>数据访问/集成模块：</strong>该模块包括了JDBC、ORM、OXM、JMS 和事务管理。</p>
<ul>
<li><strong>事务模块：</strong>该模块用于Spring 管理事务，只要是Spring管理对象都能得到Spring 管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。</li>
<li><strong>JDBC模块：</strong>提供了一个JDBC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring 管理事务的好处。</li>
<li><strong>ORM模块：</strong>提供与流行的”对象-关系”映射框架的无缝继承，包括Hibernate、JPA、Ibatiss等。而且可以使用Spring事务管理，无需额外控制事务。</li>
<li><strong>OXM模块：</strong>提供了一个对Object/XML映射实现，将java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans 和 XStream。</li>
<li><strong>JMS模块：</strong> 用于JMS(Java Messaging Service)，提供一套”消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。</li>
</ul>
<p><strong>Web/Remoting模块：</strong>Web/Remoting 模块包含了Web、Web-Servlet、Web-Struts、Web-Porlet模块。</p>
<ul>
<li><strong>Web模块：</strong>提供了基础的web功能。例如多文件上传、集成IoC容器、远程过程访问(RMI、Hessian、Burlap)以及Web Service 支持，并提供了一个RestTemplate类来提供方便的Restful service 访问。</li>
<li><strong>Web-Servlet模块：</strong>提供了一个Spring MVC Web框架实现。</li>
<li><strong>Web-Struts 模块：</strong>提供了与Struts无缝集成，Struts1.x和Struts2.x都支持</li>
</ul>
<p><strong>Test模块：</strong>Spring 支持 Junit 和TestNG 测试框架，而且还额外提供了一些基于Spring 的测试功能，比如在测试Web框架时，模拟Http请求的功能。</p>
<h4 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h4><p>Spring可以应用到许多场景，从最简单的标准Java SE 程序到企业级应用程序都能使用Spring来构建。以下介绍几个比较流行的应用场景：</p>
<ul>
<li><strong>典型Web应用程序应用场景：</strong></li>
</ul>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.jpg?raw=true" alt=""></p>
<p>在Web应用程序应用场景中，典型的三层架构：数据模型层实现域对象；数据访问层实现数据访问；逻辑层实现业务逻辑；web层提供页面展示；所有这些层组件都由Spring进行管理，享受到Spring事务管理、AOP等好处，而且请求唯一入口就是DispachterServlet，它通过把请求映射为相应web层组件来实现相应请求功能。</p>
<ul>
<li><strong>远程访问应用场景：</strong></li>
</ul>
<p>Spring能非常方便的提供暴露RMI服务，远程访问服务如Hessian、Burlap等，实现非常简单只需通过在Spring中配置相应的地址及需要暴露的服务即可轻松实现，后边会有介绍；</p>
<ul>
<li><strong>EJB应用场景：</strong></li>
</ul>
<p>Spring也可以与EJB轻松集成，后边会详细介绍。</p>
<h3 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h3><h4 id="IoC基础"><a href="#IoC基础" class="headerlink" title="IoC基础"></a>IoC基础</h4><h5 id="IoC是什么"><a href="#IoC是什么" class="headerlink" title="IoC是什么"></a>IoC是什么</h5><p>Ioc—Inversion of Control，即“控制反转”，不是什么技术，而是一种设计思想。在Java开发中，Ioc意味着将你设计好的对象交给容器控制，而不是传统的在你的对象内部直接控制。如何理解好Ioc呢？理解好Ioc的关键是要明确“谁控制谁，控制什么，为何是反转（有反转就应该有正转了），哪些方面反转了”，那我们来深入分析一下：</p>
<ul>
<li><strong>谁控制谁，控制什么：</strong>传统Java SE程序设计，我们直接在对象内部通过new进行创建对象，是程序主动去创建依赖对象；而IoC是有专门一个容器来创建这些对象，即由Ioc容器来控制对象的创建；谁控制谁？当然是IoC 容器控制了对象；控制什么？那就是主要控制了外部资源获取（不只是对象包括比如文件等）。</li>
<li><strong>为何是反转，哪些方面反转了：</strong>有反转就有正转，传统应用程序是由我们自己在对象中主动控制去直接获取依赖对象，也就是正转；而反转则是由容器来帮忙创建及注入依赖对象；为何是反转？因为由容器帮我们查找及注入依赖对象，对象只是被动的接受依赖对象，所以是反转；哪些方面反转了？依赖对象的获取被反转了。</li>
</ul>
<p>图例说明一下，传统程序设计如图2-1，都是主动去创建相关对象然后再组合起来：</p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E4%BC%A0%E7%BB%9F%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%A4%BA%E6%84%8F%E5%9B%BE.jpg?raw=true" alt=""></p>
<p>当有了IoC/DI的容器后，在客户端类中不再主动去创建这些对象了，如图2-2所示:</p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/IoCDI%E5%AE%B9%E5%99%A8%E5%90%8E%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.JPG?raw=true" alt=""></p>
<h5 id="IoC能做什么"><a href="#IoC能做什么" class="headerlink" title="IoC能做什么"></a>IoC能做什么</h5><p>IoC不是一种技术，只是一种思想，一个重要的面向对象编程的法则，它能指导我们如何设计松耦合、更优良的程序。传统应用程序都是由我们在类内部主动创建依赖对象，从而导致类与类之间高耦合，难于测试；有了IoC容器后，把创建和查找依赖对象的控制权交给了容器，由容器进行注入组合对象，所以对象与对象之间是松耦合，这样也方便测试，利于功能复用，更重要的是使得程序的整个体系结构变得非常灵活。</p>
<p>其实IoC对编程带来的最大改变不是从代码上，而是从思想上，发生了”主从换位”的变化。应用程序原本是老大，要获取什么资源都是主动出击，但是在IoC/DI思想中，应用程序就变成被动的了，被动的等待IoC容器来创建并注入它所需要的资源了。</p>
<p>IoC很好的体现了面向对象设计法则之一 – 好莱坞法则：”别找我们，我们找你”；即由IoC容器帮对象找相应的依赖对象并注入，而不是由对象主动去找。</p>
<h5 id="IoC和DI"><a href="#IoC和DI" class="headerlink" title="IoC和DI"></a>IoC和DI</h5><p><strong>DI–Dependency  Injecton</strong>，即”依赖注入”：是组件之间<strong>依赖关系由容器在运行期决定</strong>，形象的说，即由容器动态的将某个依赖关系注入到组件之中。依赖注入的目的并非为软件系统带来更多功能，而是为了提升组件重用的频率，并为系统搭建一个灵活、可扩展的平台。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可以指定目标需要的资源，完成自身的业务逻辑，而不需要关心具体的资源来自何处，由谁实现。</p>
<p>理解DI的关键是：”谁依赖谁，为什么需要依赖，谁注入谁，注入了什么”，那我们来深入分析一下：</p>
<ul>
<li><strong>谁依赖于谁：</strong>当然是某个容器管理对象依赖于IoC容器；”被注入对象的对象”依赖于”依赖对象”；</li>
<li><strong>为什么需要依赖：</strong>容器管理对象需要IoC容器来提供对象需要的外部资源；</li>
<li><strong>谁注入谁：</strong>很明细是IoC容器注入某个对象，也就是注入”依赖对象”；</li>
<li><strong>注入了什么</strong>：就是注入某个对象所需要的外部资源(包括对象、资源、常量数据)。</li>
</ul>
<p>IoC和DI有什么关系呢？其实它们是同一个概念的不同角度描述，由于控制反转概念比较模糊(可能只是理解为容器控制对象这一个层面，很难让人想到谁来维护对象关系)，所以2004年大师级人物Martin Fowler又给出了一个新的名字：”依赖注入”，相对于IoC而言，<strong>“依赖注入”明确描述了”被注入对象依赖IoC容器配置依赖对象”。</strong></p>
<h4 id="IoC容器基本原理"><a href="#IoC容器基本原理" class="headerlink" title="IoC容器基本原理"></a>IoC容器基本原理</h4><h5 id="Ioc容器的概念"><a href="#Ioc容器的概念" class="headerlink" title="Ioc容器的概念"></a>Ioc容器的概念</h5><p>IoC容器就是具有依赖注入功能的容器，IoC容器负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。应用程序无需直接在代码中new相关的对象，应用程序由IoC容器进行组装。在Spring中BeanFactory是IoC容器的实际代表者。</p>
<p>Spring IoC容器如何知道哪些是它管理的对象呢？这就需要配置文件，Spring IoC容器通过读取配置文件中的配置元数据，通过元数据对应用中的各个对象进行实例化及装配。一般使用基于xml配置文件进行配置元数据，而且<strong>Spring与配置文件完全解耦的</strong>，可以使用其他任何可能的方式进行配置元数据，比如注解、基于java文件的、基于属性文件的配置都可以。</p>
<p>那么Spring IoC容器管理的对象叫什么呢？</p>
<h5 id="Bean的概念"><a href="#Bean的概念" class="headerlink" title="Bean的概念"></a>Bean的概念</h5><p>由IoC容器管理的哪些组成你应用程序的对象我们就叫它Bean，Bean就是由Spring容器初始化、装配及管理的对象，除此之外，bean就与应用程序中的其他对象没有什么区别了。那IoC怎样确定如何实例化Bean、管理Bean之间的依赖关系以及管理Bean呢？这就需要配置元数据，在Spring中由BeanDefinition代表，后边会详细介绍，配置元数据指定如何实例化Bean、如何组装Bean等。概念知道的差不多了，让我们来做个简单的例子。</p>
<h5 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h5><p>准备Jar包</p>
<p>1、 <strong>核心jar包：</strong></p>
<p>org.springframework.asm-3.0.5.RELEASE.jar<br>org.springframework.core-3.0.5.RELEASE.jar<br>org.springframework.beans-3.0.5.RELEASE.jar<br>org.springframework.context-3.0.5.RELEASE.jar<br>org.springframework.expression-3.0.5.RELEASE.jar</p>
<p>依赖的jar包：从下载的spring-framework-3.0.5.RELEASE-dependencies.zip中查找如下依赖jar包</p>
<p>com.springsource.org.apache.log4j-1.2.15.jar</p>
<p>com.springsource.org.apache.commons.logging-1.1.1.jar</p>
<p>com.springsource.org.apache.commons.collections-3.2.1.jar</p>
<p>pom.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zero.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--集中定义依赖版本--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>3.0.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Spring相关jar包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>com.springsource.org.apache.commons.logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>com.springsource.org.apache.log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>com.springsource.org.apache.commons.collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Junit4--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>HelloApi接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter2.helloworld;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HelloApi</span> </span>&#123;  </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HelloImpl类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloImpl</span> <span class="keyword">implements</span> <span class="title">HelloApi</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1、读取配置文件实例化一个IoC容器</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"helloworld.xml"</span>);</span><br><span class="line">        <span class="comment">//2、从容器中获取Bean，注意此处完全"面向接口编程，而不是面向实现"</span></span><br><span class="line">        HelloApi helloApi = context.getBean(<span class="string">"hello"</span>, HelloApi.class);</span><br><span class="line">        <span class="comment">//3、执行业务逻辑</span></span><br><span class="line">        helloApi.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans</span><br><span class="line">        xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">        xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">        xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">        xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/context/spring-context-3.0.xsd"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!-- id 表示你这个组件的名字，<span class="class"><span class="keyword">class</span>表示组件类 --&gt;</span></span><br><span class="line">    &lt;bean id="hello" class="com.zero.spring.chapter.HelloImpl"&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>例子很简单。</p>
<p>下面深入的理解一下容器和Bean。</p>
<h5 id="详解IoC"><a href="#详解IoC" class="headerlink" title="详解IoC"></a>详解IoC</h5><p>在Spring IoC容器的代表就是org.springframework.beans包中的BeanFactory接口，BeanFactory接口提供了IoC容器最基本的功能；而org.springframework.context包下的ApplicationContext接口扩展了BeanFactory  ，还提供了与Spring AOP集成、国际化处理、事件传播及提供不同层次的context实现(如针对web应用的WebApplicationContext)。简单说，BeanFactory提供了IoC容器最基本功能，而ApplicationContext则增加了更多支持企业级功能支持。ApplicationContext完全继承BeanFactory，因而BeanFactory所具有的语义也适用于ApplicationContext。</p>
<p>容器实现一览： </p>
<ul>
<li><strong>XmlBeanFactory</strong>：BeanFactory实现，提供基本的IoC容器功能，可以从classpath或文件系统等获取资源；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）       File file = <span class="keyword">new</span> File(<span class="string">"fileSystemConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line">           Resource resource = <span class="keyword">new</span> FileSystemResource(file);</span><br><span class="line"></span><br><span class="line">           BeanFactory beanFactory = <span class="keyword">new</span> XmlBeanFactory(resource);</span><br><span class="line"></span><br><span class="line">  （<span class="number">2</span>）</span><br><span class="line"></span><br><span class="line">          Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">"classpath.xml"</span>);                 </span><br><span class="line"></span><br><span class="line">          BeanFactory beanFactory = <span class="keyword">new</span> XmlBeanFactory(resource);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ClassPathXmlApplicationContext：</strong> ApplicationContext实现，从classpath获取配置文件；</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanFactory beanFactory = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath.xml"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>FileSystemXmlApplicationContext:</strong>ApplicationContext实现， 从文件系统获取配置文件。 </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanFactory beanFactory1 = <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string">"fileSystemConfig.xml"</span>);</span><br></pre></td></tr></table></figure>
<p>ApplicationContext接口获取Bean方法简介：</p>
<ul>
<li>Object getBean(String name)根据名称返回一个Bean，客户端需要自己进行类型转换；</li>
<li>T getBean(String name,Class<t> requiredType)根据名称和指定的类型返回一个Bean，客户端无需自己进行类型转换，如果类型抓换失败，容器抛出异常；</t></li>
<li>T getBean(Class<t> requiredType) 根据指定的类型返回一个Bean，客户端无需自己进行类型转换，如果没有或有多于一个Bean存在容器将抛出异常； </t></li>
<li>Map&lt;String, T&gt; getBeansOfType(Class<t> type) 根据指定的类型返回一个键值为名字和值为Bean对象的 Map，如果没有Bean对象存在则返回空的Map。 </t></li>
</ul>
<p>让我们来看下IoC容器到底是如何工作。在此我们以xml配置方式来分析一下：</p>
<p> <strong>一、准备配置文件：</strong>就像前边Hello World 配置文件一样，在配置文件中声明Bean定义也就是BeanDefinition配置元数据。</p>
<p><strong>二、由IoC容器进行解析元数据：</strong>IoC容器的Bean Reader读取并解析配置文件，根据定义生成Bean Definition配置元数据对象，IoC容器根据BeanDefinition进行实例化、配置及组装Bean。</p>
<p><strong>三、实例化IoC容器：</strong>由客户端实例化容器，获取需要的Bean。</p>
<p>整个过程是不是很简单，执行过程如图2-5，其实IoC容器很容易使用，主要是如何进行Bean定义。下一章我们详细介绍定义Bean。</p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/SpringIoC%E5%AE%B9%E5%99%A8.jpg?raw=true" alt=""></p>
<h5 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h5><p>除了测试程序的代码外，也就是程序入口，所有代码都没有出现Spring任何组件，而且我们写的代码没有实现框架拥有的接口，因而能非常容易的替换掉Spring，是不是非侵入。</p>
<p>客户端代码完全面向接口编程，无需知道实现类，可以通过修改配置文件来更换接口实现，客户端代码不需要任何修改。是不是低耦合。</p>
<p>如果在开发初期没有真正的实现，我们可以模拟一个实现来测试，不耦合代码，是不是很方便测试。</p>
<p>Bean之间几乎没有依赖关系，是不是很容易重用。</p>
<h4 id="IoC的配置使用"><a href="#IoC的配置使用" class="headerlink" title="IoC的配置使用"></a>IoC的配置使用</h4><h5 id="XML配置的结构"><a href="#XML配置的结构" class="headerlink" title="XML配置的结构"></a>XML配置的结构</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">”resource1.xml”/</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">”bean1”class</span>=<span class="string">””</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">”bean2”class</span>=<span class="string">””</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">”bean2”class</span>=<span class="string">””</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">alias</span> <span class="attr">alias</span>=<span class="string">"bean3"</span> <span class="attr">name</span>=<span class="string">"bean2"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">”resource2.xml”/</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>1、<bean>标签主要用来进行Bean定义；</bean></p>
<p>2、alias用于定义Bean别名的；</p>
<p>3、import用于导入其他配置文件的Bean定义，这是为了加载多个配置文件，当然也可以把这些配置文件构造为一个数组（new String[] {“config1.xml”, config2.xml}）传给ApplicationContext实现进行加载多个配置文件，那一个更适合由用户决定；这两种方式都是通过调用Bean Definition Reader 读取Bean定义，内部实现没有任何区别。<import>标签可以放在<beans>下的任何位置，没有顺序关系。</beans></import></p>
<h5 id="Bean的配置"><a href="#Bean的配置" class="headerlink" title="Bean的配置"></a>Bean的配置</h5><p>Spring IoC容器目的就是管理Bean，这些Bean将根据配置文件中的Bean定义进行创建，而Bean定义在容器内部由BeanDefinition对象表示，该定义主要包含以下信息：</p>
<ul>
<li>全限定类名（FQN）：用于定义Bean的实现类;</li>
<li>Bean行为定义：这些定义了Bean在容器中的行为；包括作用域（单例、原型创建）、是否惰性初始化及生命周期等；</li>
<li>Bean创建方式定义：说明是通过构造器还是工厂方法创建Bean；</li>
<li>Bean之间关系定义：即对其他bean的引用，也就是依赖关系定义，这些引用bean也可以称之为同事bean 或依赖bean，也就是依赖注入。</li>
</ul>
<p>Bean定义只有“全限定类名”在当使用构造器或静态工厂方法进行实例化bean时是必须的，其他都是可选的定义。难道Spring只能通过配置方式来创建Bean吗？回答当然不是，某些SingletonBeanRegistry接口实现类实现也允许将那些非BeanFactory创建的、已有的用户对象注册到容器中，这些对象必须是共享的，比如使用DefaultListableBeanFactory 的registerSingleton() 方法。不过建议采用元数据定义。</p>
<h5 id="Bean的命名"><a href="#Bean的命名" class="headerlink" title="Bean的命名"></a>Bean的命名</h5><p>每个Bean可以有一个或多个id(或称之为标识符或名字)，在这里我们把<strong>第一个id称为”标识符”,其余id叫做”别名”</strong>；这些id在IoC容器中必须唯一。如何为Bean指定id呢，有以下几种方式：</p>
<p>一、  不指定id，只配置必须的全限定类名，由IoC容器为其生成一个标识，客户端必须通过接口“T getBean(Class<t> requiredType)”获取Bean； </t></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">”</span> <span class="attr">cn.javass.spring.chapter2.helloworld.HelloImpl</span>”/&gt;</span></span><br></pre></td></tr></table></figure>
<p>而是代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">BeanFactory beanFactory =  </span><br><span class="line">   <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter2/namingbean1.xml"</span>);  </span><br><span class="line">    <span class="comment">//根据类型获取bean  </span></span><br><span class="line">    HelloApi helloApi = beanFactory.getBean(HelloApi.class);  </span><br><span class="line">    helloApi.sayHello();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 二、指定id，必须在Ioc容器中唯一；</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">”</span> <span class="attr">bean</span>” <span class="attr">class</span>=<span class="string">”</span> <span class="attr">cn.javass.spring.chapter2.helloworld.HelloImpl</span>”/&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码片段如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter2/namingbean2.xml"</span>);  </span><br><span class="line"><span class="comment">//根据id获取bean  </span></span><br><span class="line">    HelloApi bean = beanFactory.getBean(<span class="string">"bean"</span>, HelloApi.class);  </span><br><span class="line">    bean.sayHello();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>三、指定name，这样name就是“标识符”，必须在Ioc容器中唯一；</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">”</span> <span class="attr">bean</span>” <span class="attr">class</span>=<span class="string">”</span> <span class="attr">cn.javass.spring.chapter2.helloworld.HelloImpl</span>”/&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码片段如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter2/namingbean3.xml"</span>);  </span><br><span class="line">    <span class="comment">//根据name获取bean  </span></span><br><span class="line">HelloApi bean = beanFactory.getBean(<span class="string">"bean"</span>, HelloApi.class);  </span><br><span class="line">bean.sayHello();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>四、指定id和name，id就是标识符，而name就是别名，必须在Ioc容器中唯一；</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">”bean1”name</span>=<span class="string">”alias1”</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">”</span> <span class="attr">cn.javass.spring.chapter2.helloworld.HelloImpl</span>”/&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 如果id和name一样，IoC容器能检测到，并消除冲突 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean3"</span> <span class="attr">name</span>=<span class="string">"bean3"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.helloworld.HelloImpl"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter2/namingbean4.xml"</span>);  </span><br><span class="line">    <span class="comment">//根据id获取bean  </span></span><br><span class="line">    HelloApi bean1 = beanFactory.getBean(<span class="string">"bean1"</span>, HelloApi.class);  </span><br><span class="line">    bean1.sayHello();  </span><br><span class="line">    <span class="comment">//根据别名获取bean  </span></span><br><span class="line">    HelloApi bean2 = beanFactory.getBean(<span class="string">"alias1"</span>, HelloApi.class);  </span><br><span class="line">    bean2.sayHello();  </span><br><span class="line">    <span class="comment">//根据id获取bean  </span></span><br><span class="line">    HelloApi bean3 = beanFactory.getBean(<span class="string">"bean3"</span>, HelloApi.class);  </span><br><span class="line">    bean3.sayHello();  </span><br><span class="line">    String[] bean3Alias = beanFactory.getAliases(<span class="string">"bean3"</span>);  </span><br><span class="line">    <span class="comment">//因此别名不能和id一样，如果一样则由IoC容器负责消除冲突  </span></span><br><span class="line">    Assert.assertEquals(<span class="number">0</span>, bean3Alias.length);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>五、指定多个name，多个name用“，”、“；”、“ ”分割，第一个被用作标识符，其他的（alias1、alias2、alias3）是别名，所有标识符也必须在Ioc容器中唯一；</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">”</span> <span class="attr">bean1</span>;<span class="attr">alias11</span>,<span class="attr">alias12</span>;<span class="attr">alias13</span> <span class="attr">alias14</span>”  </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">”</span> <span class="attr">cn.javass.spring.chapter2.helloworld.HelloImpl</span>”/&gt;</span>     </span><br><span class="line"><span class="comment">&lt;!-- 当指定id时，name指定的标识符全部为别名 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean2"</span> <span class="attr">name</span>=<span class="string">"alias21;alias22"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.helloworld.HelloImpl"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter2/namingbean5.xml"</span>);  </span><br><span class="line">    <span class="comment">//1根据id获取bean  </span></span><br><span class="line">    HelloApi bean1 = beanFactory.getBean(<span class="string">"bean1"</span>, HelloApi.class);  </span><br><span class="line">    bean1.sayHello();  </span><br><span class="line">    <span class="comment">//2根据别名获取bean  </span></span><br><span class="line">    HelloApi alias11 = beanFactory.getBean(<span class="string">"alias11"</span>, HelloApi.class);  </span><br><span class="line">    alias11.sayHello();  </span><br><span class="line">    <span class="comment">//3验证确实是四个别名         </span></span><br><span class="line">    String[] bean1Alias = beanFactory.getAliases(<span class="string">"bean1"</span>);  </span><br><span class="line">    System.out.println(<span class="string">"=======namingbean5.xml bean1 别名========"</span>);  </span><br><span class="line">    <span class="keyword">for</span>(String alias : bean1Alias) &#123;  </span><br><span class="line">        System.out.println(alias);  </span><br><span class="line">    &#125;  </span><br><span class="line">    Assert.assertEquals(<span class="number">4</span>, bean1Alias.length);  </span><br><span class="line">    <span class="comment">//根据id获取bean  </span></span><br><span class="line">    HelloApi bean2 = beanFactory.getBean(<span class="string">"bean2"</span>, HelloApi.class);  </span><br><span class="line">    bean2.sayHello();  </span><br><span class="line">    <span class="comment">//2根据别名获取bean  </span></span><br><span class="line">    HelloApi alias21 = beanFactory.getBean(<span class="string">"alias21"</span>, HelloApi.class);  </span><br><span class="line">    alias21.sayHello();  </span><br><span class="line">    <span class="comment">//验证确实是两个别名  </span></span><br><span class="line">    String[] bean2Alias = beanFactory.getAliases(<span class="string">"bean2"</span>);  </span><br><span class="line">    System.out.println(<span class="string">"=======namingbean5.xml bean2 别名========"</span>);  </span><br><span class="line">    <span class="keyword">for</span>(String alias : bean2Alias) &#123;  </span><br><span class="line">        System.out.println(alias);  </span><br><span class="line">    &#125;     </span><br><span class="line">    Assert.assertEquals(<span class="number">2</span>, bean2Alias.length);     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>六、使用<alias>标签指定别名，别名也必须在IoC容器中唯一</alias></p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"bean"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.helloworld.HelloImpl"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">alias</span>=<span class="string">"alias1"</span> <span class="attr">name</span>=<span class="string">"bean"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">alias</span>=<span class="string">"alias2"</span> <span class="attr">name</span>=<span class="string">"bean"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter2/namingbean6.xml"</span>);  </span><br><span class="line">    <span class="comment">//根据id获取bean  </span></span><br><span class="line">    HelloApi bean = beanFactory.getBean(<span class="string">"bean"</span>, HelloApi.class);  </span><br><span class="line">   bean.sayHello();  </span><br><span class="line">    <span class="comment">//根据别名获取bean  </span></span><br><span class="line">    HelloApi alias1 = beanFactory.getBean(<span class="string">"alias1"</span>, HelloApi.class);  </span><br><span class="line">    alias1.sayHello();  </span><br><span class="line">    HelloApi alias2 = beanFactory.getBean(<span class="string">"alias2"</span>, HelloApi.class);  </span><br><span class="line">    alias2.sayHello();  </span><br><span class="line">    String[] beanAlias = beanFactory.getAliases(<span class="string">"bean"</span>);  </span><br><span class="line">    System.out.println(<span class="string">"=======namingbean6.xml bean 别名========"</span>);  </span><br><span class="line">    <span class="keyword">for</span>(String alias : beanAlias) &#123;  </span><br><span class="line">        System.out.println(alias);  </span><br><span class="line">   &#125;  </span><br><span class="line">   System.out.println(<span class="string">"=======namingbean6.xml bean 别名========"</span>);  </span><br><span class="line">    Assert.assertEquals(<span class="number">2</span>, beanAlias.length);  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>从定义来看，name或id如果指定它们中的一个时都作为“标识符”，那为什么还要有id和name同时存在呢？这是因为当使用基于XML的配置元数据时，在XML中id是一个真正的XML id属性，因此当其他的定义来引用这个id时就体现出id的好处了，可以利用XML解析器来验证引用的这个id是否存在，从而更早的发现是否引用了一个不存在的bean，而使用name，则可能要在真正使用bean时才能发现引用一个不存在的bean。</p>
<p>注：ID可以被xml解析器验证是否存在，而name只有在真正调用的时候才知道</p>
<ul>
<li><strong>Bean命名约定：</strong>Bean的命名遵循XML命名规范，但最好符合Java命名规范，由”字母、数字、下划线组成”，而且应该养成一个良好的命名习惯，比如采用”驼峰式”,即第一个单词首字母开始，从第二个单词开始首字母大写开始，这样可以增加可读性。</li>
</ul>
<h5 id="实例化Bean"><a href="#实例化Bean" class="headerlink" title="实例化Bean"></a>实例化Bean</h5><p>Spring IoC容器如何实例化Bean呢？传统应用程序可以通过new和反射方式进行实例化Bean。而Spring IoC容器则需要根据Bean定义里的配置元数据使用反射机制来创建Bean。在Spring IoC容器中根据Bean定义创建Bean主要有以下几种方式：</p>
<p> 一、使用构造器实例化Bean：这是最简单的方式，Spring IoC容器即能使用默认空构造器也能使用有参数构造器两种方式创建Bean，如以下方式指定要创建的Bean类型：</p>
<p> 使用空构造器进行定义，使用此种方式，class属性指定的类必须有空构造器</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.HelloImpl2"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用有参数构造器进行定义，使用此中方式，可以使用&lt; constructor-arg &gt;标签指定构造器参数值，其中index表示位置，value表示常量值，也可以指定引用，指定引用使用ref来引用另一个Bean定义，后边会详细介绍：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"bean2"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.HelloImpl2"</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 指定构造器参数 --&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"Hello Spring!"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>知道如何配置了，让我们做个例子的例子来实践一下吧：</p>
<p>（1）准备Bean class(HelloImpl2.java)，该类有一个空构造器和一个有参构造器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter2;   </span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloImpl2</span> <span class="keyword">implements</span> <span class="title">HelloApi</span> </span>&#123;  </span><br><span class="line">           <span class="keyword">private</span> String message;  </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">HelloImpl2</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                  <span class="keyword">this</span>.message = <span class="string">"Hello World!"</span>;  </span><br><span class="line">           &#125;  </span><br><span class="line">         <span class="function">Public <span class="title">HelloImpl2</span><span class="params">(String message)</span> </span>&#123;  </span><br><span class="line">                  <span class="keyword">this</span>.message = message;  </span><br><span class="line">           &#125;  </span><br><span class="line">           <span class="meta">@Override</span>  </span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                  System.out.println(message);  </span><br><span class="line">           &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2)在配置文件xml中配置Bean定义，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用默认构造器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.HelloImpl2"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--使用有参数的构造器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"bean2"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.HelloImpl2"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定构造器参数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"Hello Spring"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）配置完了，让我们写段测试代码（InstantiatingContainerTest）来看下是否工作吧：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1、读取配置文件实例化一个IoC容器</span></span><br><span class="line">        BeanFactory beanFactory = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"helloworld.xml"</span>);</span><br><span class="line">        <span class="comment">//2、从容器中获取Bean，注意此处完全"面向接口编程，而不是面向实现"</span></span><br><span class="line">        HelloApi bean1 = beanFactory.getBean(<span class="string">"bean1"</span>, HelloApi.class);</span><br><span class="line">        <span class="comment">//3、执行业务逻辑</span></span><br><span class="line">        bean1.sayHello();</span><br><span class="line">        HelloApi bean2 = beanFactory.getBean(<span class="string">"bean2"</span>,HelloApi.class);</span><br><span class="line">        bean2.sayHello();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二、使用静态工厂方式实例化Bean，使用这种方式除了指定必须的class属性，还要指定factory-method属性来指定实例化Bean的方法，而且使用静态工厂方法也允许指定方法参数，spring IoC容器将调用此属性指定的方法来获取Bean，配置如下所示：</p>
<p>​    （1）先来看看静态工厂类代码吧HelloApiStaticFactory：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApiStaticFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">//工厂方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HelloApi <span class="title">newInstance</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//返回需要的Bean实例</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloImpl2(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）静态工厂写完了，让我们在配置文件(resources/**.xml)配置Bean定义：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用静态工厂方法 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean3"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.HelloApiStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"Hello Spring!"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）配置完了，让我们写段测试代码（InstantiatingContainerTest）来看下是否工作吧：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInstantiatingBeanByStaticFactory</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">       <span class="comment">//使用静态工厂方法  </span></span><br><span class="line">       BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chaper2/instantiatingBean.xml"</span>);  </span><br><span class="line">       HelloApi bean3 = beanFactory.getBean(<span class="string">"bean3"</span>, HelloApi.class);  </span><br><span class="line">       bean3.sayHello();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>三、使用实例工厂方法实例化Bean，使用这种方式不能指定class属性，此时必须使用factory-bean属性来指定工厂Bean，factory-method属性指定实例化Bean的方法，而且使用实例工厂方法允许指定方法参数，方式和使用构造器方式一样，配置如下：</p>
<p> （1）实例工厂类代码（HelloApiInstanceFactory.java）如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter2;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApiInstanceFactory</span> </span>&#123;  </span><br><span class="line"><span class="function"><span class="keyword">public</span> HelloApi <span class="title">newInstance</span><span class="params">(String message)</span> </span>&#123;  </span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> HelloImpl2(message);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）让我们在配置文件(resources/chapter2/instantiatingBean.xml)配置Bean定义：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">!—1、定义实例工厂Bean</span> <span class="attr">--</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beanInstanceFactory"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.HelloApiInstanceFactory"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">!—2、使用实例工厂Bean创建Bean</span> <span class="attr">--</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean4"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">factory-bean</span>=<span class="string">"beanInstanceFactory"</span>  </span></span><br><span class="line"><span class="tag">     <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"Hello Spring!"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）测试代码InstantiatingBeanTest：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInstantiatingBeanByInstanceFactory</span><span class="params">()</span> </span>&#123;  </span><br><span class="line"><span class="comment">//使用实例工厂方法  </span></span><br><span class="line">       BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter2/instantiatingBean.xml"</span>);  </span><br><span class="line">       HelloApi bean4 = beanFactory.getBean(<span class="string">"bean4"</span>, HelloApi.class);  </span><br><span class="line">       bean4.sayHello();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  通过以上例子我们已经基本掌握了如何实例化Bean了，大家是否注意到？这三种方式只是配置不一样，从获取方式看完全一样，没有任何不同。这也是Spring IoC的魅力，Spring IoC帮你创建Bean，我们只管使用就可以了，是不是很简单。</p>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><p>到此我们已经讲完了Spring IoC基础部分，包括IoC容器概念，如何实例化容器，Bean配置、命名及实例化，Bean获取等等。不知大家是否注意到目前为止，我们只能通过简单的实例化Bean，没有涉及Bean之间关系。接下来一章让我们进入配置Bean之间关系章节，也就是依赖注入。</p>
<h3 id="DI的配置使用"><a href="#DI的配置使用" class="headerlink" title="DI的配置使用"></a>DI的配置使用</h3><h4 id="依赖和依赖注入"><a href="#依赖和依赖注入" class="headerlink" title="依赖和依赖注入"></a>依赖和依赖注入</h4><p>​    传统应用程序设计中所说的依赖一般指”类之间的关系”，那让我们复习一下类之间的关系：</p>
<ul>
<li><strong>泛化：</strong>表示类与类之间的继承关系、接口与接口之间的继承关系；</li>
<li><strong>实现：</strong>表示类对接口的实现；</li>
<li><strong>依赖</strong>：当类与类之间有使用关系时就属于依赖关系，不同于关联关系，依赖不具有“拥有关系”，而是一种“相识关系”，只在某个特定地方（比如某个方法体内）才有关系。</li>
<li><strong>关联：</strong>表示类与类或类与接口之间的依赖关系，表现为“拥有关系”；具体到代码可以用实例变量来表示；</li>
<li><strong>聚合：</strong>属于是关联的特殊情况，体现部分-整体关系，是一种弱拥有关系；整体和部分可以有不一样的生命周期；是一种弱关联；</li>
<li><strong>组合：</strong>属于是关联的特殊情况，也体现了体现部分-整体关系，是一种强“拥有关系”；整体与部分有相同的生命周期，是一种强关联；</li>
</ul>
<p>Spring IoC容器的依赖有两层含义：Bean依赖容器和容器注入Bean的依赖资源：</p>
<ul>
<li><strong>Bean依赖容器：</strong>：也就是说Bean要依赖于容器，这里的依赖是指容器负责创建Bean并管理Bean的生命周期，正是由于由容器来控制创建Bean并注入依赖，也就是控制权被反转了，这也正是IoC名字的由来，<strong>此处的有依赖是指Bean和容器之间的依赖关系。</strong></li>
<li><strong>容器注入Bean的依赖资源：</strong>容器负责注入Bean的依赖资源，依赖资源可以是Bean、外部文件、常量数据等，在Java中都反映为对象，并且由容器负责组装Bean之间的依赖关系，<strong>此处的依赖是指Bean之间的依赖关系，可以认为是传统类与类之间的“关联”、“聚合”、“组合”关系。</strong></li>
</ul>
<p>为什么要应用依赖注入，应用依赖注入能给我们带来哪些好处呢？</p>
<ul>
<li><strong>动态替换Bean依赖对象，程序更灵活：</strong>替换Bean依赖对象，无需修改源文件：应用依赖注入后，由于可以采用配置文件方式实现，从而能随时动态的替换Bean的依赖对象，无需修改java源文件；</li>
<li><strong>更好实践面向接口编程，代码更清晰：</strong>：在Bean中只需指定依赖对象的接口，接口定义依赖对象完成的功能，通过容器注入依赖实现；</li>
<li><strong>更好实践优先使用对象组合，而不是类继承：</strong>因为IoC容器采用注入依赖，也就是组合对象，从而更好的实践对象组合。</li>
</ul>
<p>采用对象组合，Bean的功能可能由几个依赖Bean的功能组合而成，其Bean本身可能只提供少许功能或根本无任何功能，全部委托给依赖Bean，对象组合具有动态性，能更方便的替换掉依赖Bean，从而改变Bean功能；</p>
<p>而如果采用类继承，Bean没有依赖Bean，而是采用继承方式添加新功能，，而且功能是在编译时就确定了，不具有动态性，而且采用类继承导致Bean与子Bean之间高度耦合，难以复用。</p>
<ul>
<li><strong>增加Bean可复用性：</strong>依赖于对象组合，Bean更可复用且复用更简单；</li>
<li><strong>降低Bean之间耦合：</strong>由于我们完全采用面向接口编程，在代码中没有直接引用Bean依赖实现，全部引用接口，而且不会出现显示的创建依赖对象代码，而且这些依赖是由容器来注入，很容易替换依赖实现类，从而降低Bean与依赖之间耦合；</li>
<li><strong>代码结构更清晰：</strong>要应用依赖注入，代码结构要按照规约方式进行书写，从而更好的应用一些最佳实践，因此代码结构更清晰。</li>
</ul>
<p>从以上我们可以看出，其实依赖注入只是一种装配对象的手段，设计的类结构才是基础，如果设计的类结构不支持依赖注入，Spring IoC容器也注入不了任何东西，从而从根本上说<strong>“如何设计好类结构才是关键，依赖注入只是一种装配对象手段”。</strong></p>
<p>前边IoC一章我们已经了解了Bean依赖容器，那容器如何注入Bean的依赖资源，Spring IoC容器注入依赖资源主要有以下两种基本实现方式：</p>
<p>​      <strong>构造器注入：</strong>就是容器实例化Bean时注入那些依赖，通过在在Bean定义中指定构造器参数进行注入依赖，包括实例工厂方法参数注入依赖，<strong>但静态工厂方法参数不允许注入依赖</strong>；</p>
<p>​      <strong>setter注入</strong>：通过setter方法进行注入依赖；</p>
<p>​      <strong>方法注入</strong>：能通过配置方式替换掉Bean方法，也就是通过配置改变Bean方法 功能。</p>
<p> 我们已经知道注入实现方式了，接下来让我们来看看具体配置吧。</p>
<h5 id="构造器注入"><a href="#构造器注入" class="headerlink" title="构造器注入"></a>构造器注入</h5><p>​       使用构造器注入通过配置构造器参数实现，<strong>构造器参数就是依赖</strong>。除了构造器方式，还有静态工厂、实例工厂方法可以进行构造器注入。如图3-1所示：</p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.JPG?raw=true" alt=""></p>
<p>图3-1 实例化 </p>
<p>构造器注入可以根据参数索引注入、参数类型注入或Spring3支持的参数名注入，但参数名注入是有限制的，需要使用在编译程序时打开调试模式（即在编译时使用“javac –g:vars”在class文件中生成变量调试信息，默认是不包含变量调试信息的，从而能获取参数名字，否则获取不到参数名字）或在构造器上使用@ConstructorProperties（java.beans.ConstructorProperties）注解来指定参数名。</p>
<p> 首先让我们准备测试构造器类HelloImpl3.java，该类只有一个包含两个参数的构造器：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloImpl3</span> <span class="keyword">implements</span> <span class="title">HelloApi</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@java.beans.ConstructorProperties(&#123;"message", "index"&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloImpl3</span><span class="params">(String message, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">        <span class="keyword">this</span>.index = index;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(index + <span class="string">":"</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一、根据参数索引注入，使用标签“<constructor-arg index="1" value="1">”来指定注入的依赖，其中“index”表示索引，从0开始，即第一个参数索引为0，“value”来指定注入的常量值，配置方式如下：</constructor-arg></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8F%82%E6%95%B0%E7%B4%A2%E5%BC%95%E6%B3%A8%E5%85%A5.JPG?raw=true" alt=""></p>
<p>二、根据参数类型进行注入，使用标签“<constructor-arg type="java.lang.String" value="Hello World!">”来指定注入的依赖，其中“type”表示需要匹配的参数类型，可以是基本类型也可以是其他类型，如“int”、“java.lang.String”，“value”来指定注入的常量值，配置方式如下：</constructor-arg></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E7%B1%BB%E5%9E%8B%E6%B3%A8%E5%85%A5.JPG?raw=true" alt=""></p>
<p>三、根据参数名进行注入，使用标签“<constructor-arg name="message" value="Hello World!">”来指定注入的依赖，其中“name”表示需要匹配的参数名字，“value”来指定注入的常量值，配置方式如下：</constructor-arg></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8F%82%E6%95%B0%E5%90%8D%E6%B3%A8%E5%85%A5.JPG?raw=true" alt=""></p>
<p>四、让我们来用具体的例子来看一下构造器注入怎么使用吧。</p>
<p> （1）首先准备Bean类，在此我们就使用“HelloImpl3”这个类。</p>
<p> （2）有了Bean类，接下来要进行Bean定义配置，我们需要配置三个Bean来完成上述三种依赖注入测试，其中Bean ”byIndex”是通过索引注入依赖；Bean ”byType”是根据类型进行注入依赖；Bean ”byName”是根据参数名字进行注入依赖，具体配置文件（resources/chapter3/ constructorDependencyInject.xml）如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过构造器参数索引方式依赖注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byIndex"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.HelloImpl3"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通过构造器参数类型方式依赖注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byType"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.HelloImpl3"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通过构造器参数名称方式依赖注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byName"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.HelloImpl3"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（4）接下来让我们测试一下配置是否工作，具体测试代码（cn.javass.spring.chapter3. DependencyInjectTest）如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BeanFactory beanFactory = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"helloworld.xml"</span>);</span><br><span class="line"><span class="comment">//获取根据参数索引依赖注入的Bean</span></span><br><span class="line">        HelloApi byIndex = beanFactory.getBean(<span class="string">"byIndex"</span>, HelloApi.class);</span><br><span class="line">        byIndex.sayHello();</span><br><span class="line"><span class="comment">//获取根据参数类型依赖注入的Bean</span></span><br><span class="line">        HelloApi byType = beanFactory.getBean(<span class="string">"byType"</span>, HelloApi.class);</span><br><span class="line">        byType.sayHello();</span><br><span class="line"><span class="comment">//获取根据参数名字依赖注入的Bean</span></span><br><span class="line">        HelloApi byName = beanFactory.getBean(<span class="string">"byName"</span>, HelloApi.class);</span><br><span class="line">        byName.sayHello();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​       通过以上测试我们已经会基本的构造器注入配置了，在测试通过参数名字注入时，除了可以使用以上方式，还可以通过在构造器上添加@java.beans.ConstructorProperties({“message”, “index”})注解来指定参数名字，在HelloImpl3构造器上把注释掉的“ConstructorProperties”打开就可以了，这个就留给大家做练习，自己配置然后测试一下。</p>
<p> 五、大家已经会了构造器注入，那让我们再看一下静态工厂方法注入和实例工厂注入吧，其实它们注入配置是完全一样，在此我们只示范一下静态工厂注入方式和实例工厂方式配置，测试就留给大家自己练习：</p>
<p>​        （1）静态工厂类</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//静态工厂类  </span></span><br><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3;  </span><br><span class="line"><span class="keyword">import</span> cn.javass.spring.chapter2.helloworld.HelloApi;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependencyInjectByStaticFactory</span> </span>&#123;  </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HelloApi <span class="title">newInstance</span><span class="params">(String message, <span class="keyword">int</span> index)</span> </span>&#123;  </span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> HelloImpl3(message, index);  </span><br><span class="line">       &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​        静态工厂类Bean定义配置文件（chapter3/staticFactoryDependencyInject.xml）</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byIndex"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.DependencyInjectByStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byType"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.DependencyInjectByStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byName"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.DependencyInjectByStaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"3"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）实例工厂类</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例工厂类  </span></span><br><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3;  </span><br><span class="line"><span class="keyword">import</span> cn.javass.spring.chapter2.helloworld.HelloApi;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependencyInjectByInstanceFactory</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloApi <span class="title">newInstance</span><span class="params">(String message, <span class="keyword">int</span> index)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloImpl3(message, index);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​        实例工厂类Bean定义配置文件（chapter3/instanceFactoryDependencyInject.xml）</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"instanceFactory"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.DependencyInjectByInstanceFactory"</span>/&gt;</span>  </span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byIndex"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">factory-bean</span>=<span class="string">"instanceFactory"</span>  <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byType"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">factory-bean</span>=<span class="string">"instanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"java.lang.String"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"byName"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">factory-bean</span>=<span class="string">"instanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"newInstance"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"3"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​       （3）测试代码和构造器方式完全一样，只是配置文件不一样，大家只需把测试文件改一下就可以了。还有一点需要大家注意就是静态工厂方式和实例工厂方式根据参数名字注入的方式只支持通过在class文件中添加“变量调试信息”方式才能运行，ConstructorProperties注解方式不能工作，它只对构造器方式起作用，<strong>不建议使用根据参数名进行构造器注入</strong>。</p>
<h5 id="setter注入"><a href="#setter注入" class="headerlink" title="setter注入"></a>setter注入</h5><p>​       setter注入，是通过在通过构造器、静态工厂或实例工厂实例好Bean后，通过调用Bean类的setter方法进行注入依赖，如图3-3所示：</p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/setter%E6%B3%A8%E5%85%A5.JPG?raw=true" alt=""></p>
<p>图3-3 setter注入方式</p>
<p>​       </p>
<p> setter注入方式只有一种根据setter名字进行注入：</p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/setter%E6%B3%A8%E5%85%A52.JPG?raw=true" alt=""></p>
<p>​       知道配置方式了，接下来先让我们来做个简单例子吧。</p>
<p> （1）准备测试类HelloImpl4，需要两个setter方法“setMessage”和“setIndex”：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld4</span> <span class="keyword">implements</span> <span class="title">HelloApi</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setter方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIndex</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.index = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(index + <span class="string">":"</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​       （2）配置Bean定义，具体配置文件（resources/chapter3/setterDependencyInject.xml）片段如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过setter方式进行依赖注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.HelloWorld4"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）该写测试进行测试一下是否满足能工作了，其实测试代码一点没变，变的是配置：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTest4</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        BeanFactory beanFactory = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"helloworld.xml"</span>);</span><br><span class="line">        HelloApi bean = beanFactory.getBean(<span class="string">"bean"</span>,HelloApi.class);</span><br><span class="line">        bean.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​       知道如何配置了，但Spring如何知道setter方法？如何将值注入进去的呢？其实方法名是要遵守约定的，setter注入的方法名要遵循“JavaBean getter/setter 方法命名约定”：</p>
<p>​        JavaBean：是本质就是一个POJO类，但具有一下限制：</p>
<ul>
<li>该类必须要有公共的无参构造器，如public HelloImpl4(){};</li>
<li>属性为private访问级别，不建议public，如private String message；</li>
<li>属性必要时通过一组setter(修改器)和getter<strong>（访问器）方法来访问</strong> ;</li>
<li><strong>setter方法，以“set”开头，后跟首字母大写的属性名</strong>，如“setMesssage”,简单属性一般只有一个方法参数，方法返回值通常为“void”; </li>
<li><strong>getter方法，一般属性以“get”开头，对于boolean类型一般以“is”开头，后跟首字母大写的属性名</strong>，如“getMesssage”，“isOk”； </li>
<li>还有一些其他特殊情况，<strong>比如属性有连续两个大写字母开头，如“URL”,则setter/getter方法为：“setURL”和“getURL”</strong>，其他一些特殊情况请参看“Java Bean”命名规范。 </li>
</ul>
<h5 id="注入常量"><a href="#注入常量" class="headerlink" title="注入常量"></a>注入常量</h5><h5 id="注入常量是依赖注入中最简单的。配置方式如下所示："><a href="#注入常量是依赖注入中最简单的。配置方式如下所示：" class="headerlink" title="注入常量是依赖注入中最简单的。配置方式如下所示："></a>注入常量是依赖注入中最简单的。配置方式如下所示：</h5> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Hello World!"</span>/&gt;</span>  </span><br><span class="line">或  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"index"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"Apple-style-span"</span> <span class="attr">style</span>=<span class="string">"font-size: 14px; white-space: normal; background-color: #ffffff;"</span>&gt;</span> <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​       以上两种方式都可以，从配置来看第一种更简洁。注意此处“value”中指定的全是字符串，由Spring容器将此字符串转换成属性所需要的类型，如果转换出错，将抛出相应的异常。</p>
<p> Spring容器目前能对各种基本类型把配置的String参数转换为需要的类型。</p>
<p> 注：Spring类型转换系统对于boolean类型进行了容错处理，除了可以使用“true/false”标准的Java值进行注入，还能使用“yes/no”、“on/off”、“1/0”来代表“真/假”，所以大家在学习或工作中遇到这种类似问题不要觉得是人家配置错了，而是Spring容错做的非常好。</p>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">测试类  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooleanTestBean</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> success;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuccess</span><span class="params">(<span class="keyword">boolean</span> success)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.success = success;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSuccess</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> success;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">配置文件（chapter3/booleanInject.xml）片段：  </span><br><span class="line">&lt;!-- <span class="keyword">boolean</span>参数值可以用on/off --&gt;  </span><br><span class="line">&lt;bean id=<span class="string">"bean2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.javass.spring.chapter3.bean.BooleanTestBean"</span>&gt;  </span><br><span class="line">    &lt;property name=<span class="string">"success"</span> value=<span class="string">"on"</span>/&gt;  </span><br><span class="line">&lt;/bean&gt;  </span><br><span class="line">&lt;!-- <span class="keyword">boolean</span>参数值可以用yes/no --&gt;  </span><br><span class="line">&lt;bean id=<span class="string">"bean3"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.javass.spring.chapter3.bean.BooleanTestBean"</span>&gt;  </span><br><span class="line">    &lt;property name=<span class="string">"success"</span> value=<span class="string">"yes"</span>/&gt;  </span><br><span class="line">&lt;/bean&gt;  </span><br><span class="line">&lt;!-- <span class="keyword">boolean</span>参数值可以用<span class="number">1</span>/<span class="number">0</span> --&gt;  </span><br><span class="line">&lt;bean id=<span class="string">"bean4"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.javass.spring.chapter3.bean.BooleanTestBean"</span>&gt;  </span><br><span class="line">   &lt;property name=<span class="string">"success"</span> value=<span class="string">"1"</span>/&gt;  </span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h5 id="注入Bean-ID"><a href="#注入Bean-ID" class="headerlink" title="注入Bean ID"></a>注入Bean ID</h5><p>用于注入Bean的ID，ID是一个常量不是引用，且类似于注入常量，但提供错误验证功能，配置方式如下所示：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;<span class="name">idref</span> <span class="attr">bean</span>=<span class="string">"bean1"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;<span class="name">idref</span> <span class="attr">local</span>=<span class="string">"bean2"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>两种方式都可以，上述配置本质上在运行时等于如下方式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"……"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"idrefBean1"</span> <span class="attr">class</span>=<span class="string">"……"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span> =<span class="string">"bean1"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二种方式（<idref bean="bean1">）可以在容器初始化时校验被引用的Bean是否存在，如果不存在将抛出异常，而第一种方式（<idref local="bean2">）只有在Bean实际使用时才能发现传入的Bean的ID是否正确，可能发生不可预料的错误。因此如果想注入Bean的ID，推荐使用第二种方式。</idref></idref></p>
<p> 接下来学习一下如何使用吧：</p>
<p> 首先定义测试Bean：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdRefTestBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>其次定义配置文件（chapter3/idRefInject.xml）：</strong></p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"test"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean2"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"test"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"idrefBean1"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.bean.IdRefTestBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;<span class="name">idref</span> <span class="attr">bean</span>=<span class="string">"bean1"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"idrefBean2"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.bean.IdRefTestBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;<span class="name">idref</span> <span class="attr">local</span>=<span class="string">"bean2"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​       从配置中可以看出，注入的Bean的ID是一个java.lang.String类型，即字符串类型，因此注入的同样是常量，只是具有校验功能。</p>
<p> <idref bean="……">将在容器初始化时校验注入的ID对于的Bean是否存在，如果不存在将抛出异常。</idref></p>
<p> <idref local="……">将在XML解析时校验注入的ID对于的Bean在当前配置文件中是否存在，如果不存在将抛出异常，它不同于<idref bean="……">，<idref local="……">是校验发生在XML解析式而非容器初始化时，且只检查当前配置文件中是否存在相应的Bean。</idref></idref></idref></p>
<h5 id="注入集合、数组和字典"><a href="#注入集合、数组和字典" class="headerlink" title="注入集合、数组和字典"></a>注入集合、数组和字典</h5><p>​       Spring不仅能注入简单类型数据，还能注入集合（Collection、无序集合Set、有序集合List）类型、数组(Array)类型、字典(Map)类型数据、Properties类型数据，接下来就让我们一个个看看如何注入这些数据类型的数据。</p>
<p>​        <strong>一、注入集合类型：</strong>包括Collection类型、Set类型、List类型数据：</p>
<p>​        <strong>（1）List类型:需要使用<list>标签来配置注入，其具体配置如下：</list></strong></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%B3%A8%E5%85%A5list.JPG?raw=true" alt=""></p>
<p>​       让我们来写个测试来练习一下吧：</p>
<p>​              <strong>准备测试类：</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListTestBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; values;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getValues</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> values;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValues</span><span class="params">(List&lt;String&gt; values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.values = values;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​              <strong>进行Bean定义，在配置文件（resources/chapter3/listInject.xml）中配置list注入：</strong></p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"listBean"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.bean.ListTestBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"values"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTest4</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        BeanFactory beanFactory = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"helloworld.xml"</span>);</span><br><span class="line">        ListTestBean listBean = beanFactory.getBean(<span class="string">"listBean"</span>,ListTestBean.class);</span><br><span class="line">        System.out.println(listBean.getValues().size());</span><br><span class="line">        Assert.assertEquals(<span class="number">3</span>,listBean.getValues().size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>（2）Set类型：需要使用<set>标签来配置注入，其配置参数及含义和<lsit>标签完全一样，在此就不阐述了： </lsit></set></strong></p>
<p>​              <strong>准备测试类：</strong></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3.bean;  </span><br><span class="line"><span class="keyword">import</span> java.util.Collection;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionTestBean</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> Collection&lt;String&gt; values;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValues</span><span class="params">(Collection&lt;String&gt; values)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.values = values;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;String&gt; <span class="title">getValues</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> values;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​              <strong>进行Bean定义，在配置文件（resources/chapter3/listInject.xml）中配置list注入：</strong></p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"setBean"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.SetTestBean"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"values"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​              具体测试代码就不写了，和listBean测试代码完全一样。</p>
<p> <strong>(2)Collection类型：</strong>因为Collection类型是Set和List类型的基类型，所以使用<set>或<list>标签都可以进行注入，配置方式完全和以上配置方式一样，只是将测试类属性改成“Collection”类型，如果配置有问题，可参考cn.javass.spring.chapter3.DependencyInjectTest测试类中的testCollectionInject测试方法中的代码。</list></set></p>
<p>二、<strong>注入数组类型</strong>：需要使用<array>标签来配置注入，其中标签属性“value-type”和“merge”和<list>标签含义完全一样，具体配置如下：</list></array></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%B3%A8%E5%85%A5%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B.JPG?raw=true" alt=""></p>
<p>​       <strong>三、注入字典（Map）类型：</strong>字典类型是包含键值对数据的数据结构，需要使用<map>标签来配置注入，其属性“key-type”和“value-type”分别指定“键”和“值”的数据类型，其含义和<list>标签的“value-type”含义一样，在此就不罗嗦了，并使用<key>子标签来指定键数据，<value>子标签来指定键对应的值数据，具体配置如下：</value></key></list></map></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E6%B3%A8%E5%85%A5%E5%AD%97%E5%85%B8.JPG?raw=true" alt=""></p>
<p>四、Properties注入：Spring能注入java.util.Properties类型数据，需要使用<props>标签来配置注入，键和值类型必须是String，不能变，子标签<prop key="”键”">值</prop>来指定键值对，具体配置如下：</props></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/properties%E6%B3%A8%E5%85%A5.JPG?raw=true" alt=""></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/properties%E6%B3%A8%E5%85%A52.JPG?raw=true" alt=""></p>
<p>如果练习时遇到配置问题，可以参考cn.javass.spring.chapter3.DependencyInjectTest测试类中的testPropertiesInject测试方法中的代码。</p>
<p>​        到此我们已经把简单类型及集合类型介绍完了，大家可能会问怎么没见注入“Bean之间关系”的例子呢？接下来就让我们来讲解配置Bean之间依赖关系，也就是注入依赖Bean。</p>
<h5 id="引用其它Bean"><a href="#引用其它Bean" class="headerlink" title="引用其它Bean"></a>引用其它Bean</h5><p>​        上边章节已经介绍了注入常量、集合等基本数据类型和集合数据类型，本小节将介绍注入依赖Bean及注入内部Bean。</p>
<p>​        引用其他Bean的步骤与注入常量的步骤一样，可以通过构造器注入及setter注入引用其他Bean，只是引用其他Bean的注入配置稍微变化了一下：可以将“<constructor-arg index="0" value="Hello World!">”和“<property name="message" value="Hello World!">”中的value属性替换成bean属性，其中bean属性指定配置文件中的其他Bean的id或别名。另一种是把<value>标签替换为&lt;.ref bean=”beanName”&gt;，bean属性也是指定配置文件中的其他Bean的id或别名。那让我们看一下具体配置吧：</value></property></constructor-arg></p>
<p> <strong>一、构造器注入方式：</strong></p>
<p> （1）通过” <constructor-arg>”标签的ref属性来引用其他Bean，这是最简化的配置：</constructor-arg></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5.JPG?raw=true" alt=""></p>
<p>（2）通过” <constructor-arg>”标签的子<ref>标签来引用其他Bean，使用bean属性来指定引用的Bean：</ref></constructor-arg></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A52.JPG?raw=true" alt=""></p>
<p>   <strong>二、setter注入方式：</strong></p>
<p>（1）通过” <property>”标签的ref属性来引用其他Bean，这是最简化的配置：</property></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-setter%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F.JPG?raw=true" alt=""></p>
<p>（2）通过” <property>”标签的子<ref>标签来引用其他Bean，使用bean属性来指定引用的Bean：</ref></property></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/bean-propertie%E5%AD%90%E6%A0%87%E7%AD%BE.JPG?raw=true" alt=""></p>
<p>三、接下来让我们用个具体例子来讲解一下具体使用吧：</p>
<p> （1）首先让我们定义测试引用Bean的类，在此我们可以使用原有的HelloApi实现，然后再定义一个装饰器来引用其他Bean，具体装饰类如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApiDecorator</span> <span class="keyword">implements</span> <span class="title">HelloApi</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HelloApi helloApi;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//空参构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloApiDecorator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//有参构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloApiDecorator</span><span class="params">(HelloApi helloApi)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloApi = helloApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHelloApi</span><span class="params">(HelloApi helloApi)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloApi = helloApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"==========装饰一下==========="</span>);</span><br><span class="line">        helloApi.sayHello();</span><br><span class="line">        System.out.println(<span class="string">"==========装饰一下==========="</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​       （2）定义好了测试引用Bean接下来该在配置文件(resources/chapter3/beanInject.xml)进行配置Bean定义了，在此将演示通过构造器及setter方法方式注入依赖Bean：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义依赖Bean --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloApi"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.helloworld.HelloImpl"</span>/&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 通过构造器注入 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.HelloApiDecorator"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"helloApi"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 通过构造器注入 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean2"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.HelloApiDecorator"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"helloApi"</span>&gt;</span><span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">" helloApi"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）测试一下吧，测试代码(cn.javass.spring.chapter3.DependencyInjectTest)片段如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBeanInject</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    BeanFactory beanFactory =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter3/beanInject.xml"</span>);  </span><br><span class="line">    <span class="comment">//通过构造器方式注入  </span></span><br><span class="line">    HelloApi bean1 = beanFactory.getBean(<span class="string">"bean1"</span>, HelloApi.class);  </span><br><span class="line">    bean1.sayHello();  </span><br><span class="line">    <span class="comment">//通过setter方式注入  </span></span><br><span class="line">    HelloApi bean2 = beanFactory.getBean(<span class="string">"bean2"</span>, HelloApi.class);  </span><br><span class="line">    bean2.sayHello();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​       <strong>四、其他引用方式：</strong>除了最基本配置方式以外，Spring还提供了另外两种更高级的配置方式，<ref local="””/">和<ref parent="””/"><strong>：</strong></ref></ref></p>
<p>​        （1）<ref local="””/">配置方式：用于引用通过<bean id="”beanName”">方式中通过id属性指定的Bean，它能利用XML解析器的验证功能在读取配置文件时来验证引用的Bean是否存在。因此如果在当前配置文件中有相互引用的Bean可以采用<ref local="">方式从而如果配置错误能在开发调试时就发现错误。</ref></bean></ref></p>
<p> 如果引用一个在当前配置文件中不存在的Bean将抛出如下异常：</p>
<p> org.springframework.beans.factory.xml.XmlBeanDefinitionStoreException: Line21 inXML document from class path resource [chapter3/beanInject2.xml] is invalid; nested exception is org.xml.sax.SAXParseException: cvc-id.1: There is no ID/IDREF binding for IDREF ‘helloApi’.</p>
<p> <ref local="">具体配置方式如下：</ref></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/ref%20local%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F.JPG?raw=true" alt=""></p>
<p>​       （2）<ref parent="””/">配置方式：用于引用父容器中的Bean，不会引用当前容器中的Bean，当然父容器中的Bean和当前容器的Bean是可以重名的，获取顺序是直接到父容器找。具体配置方式如下：</ref></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/ref%20parent.JPG?raw=true" alt=""></p>
<p>接下来让我们用个例子演示一下<ref local="">和<ref parent="">的配置过程：</ref></ref></p>
<p> 首先还是准备测试类，在此我们就使用以前写好的HelloApiDecorator和HelloImpl4类；其次进行Bean定义，其中当前容器bean1引用本地的”helloApi”，而”bean2”将引用父容器的”helloApi”，配置如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- sources/chapter3/parentBeanInject.xml表示父容器配置--&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--注意此处可能子容器也定义一个该Bean--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloApi"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.HelloImpl4"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Hello Parent!"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- sources/chapter3/localBeanInject.xml表示当前容器配置--&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 注意父容器中也定义了id 为 helloApi的Bean --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloApi"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.HelloImpl4"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"index"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"message"</span> <span class="attr">value</span>=<span class="string">"Hello Local!"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 通过local注入 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.HelloApiDecorator"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span>&gt;</span><span class="tag">&lt;<span class="name">ref</span> <span class="attr">local</span>=<span class="string">"helloApi"</span>/&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!-- 通过parent注入 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean2"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.HelloApiDecorator"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"helloApi"</span>&gt;</span><span class="tag">&lt;<span class="name">ref</span> <span class="attr">parent</span>=<span class="string">"helloApi"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（3）写测试类测试一下吧，具体代码片段如下： </p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLocalAndparentBeanInject</span><span class="params">()</span> </span>&#123;  </span><br><span class="line"><span class="comment">//初始化父容器  </span></span><br><span class="line">ApplicationContext parentBeanContext =  </span><br><span class="line"><span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"chapter3/parentBeanInject.xml"</span>);  </span><br><span class="line"><span class="comment">//初始化当前容器  </span></span><br><span class="line">ApplicationContext beanContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(  </span><br><span class="line"><span class="keyword">new</span> String[] &#123;<span class="string">"chapter3/localBeanInject.xml"</span>&#125;, parentBeanContext);  </span><br><span class="line">    HelloApi bean1 = beanContext.getBean(<span class="string">"bean1"</span>, HelloApi.class);  </span><br><span class="line">    bean1.sayHello();<span class="comment">//该Bean引用local bean  </span></span><br><span class="line">HelloApi bean2 = beanContext.getBean(<span class="string">"bean2"</span>, HelloApi.class);  </span><br><span class="line">bean2.sayHello();<span class="comment">//该Bean引用parent bean  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> “bean1”将输出“Hello Local!”表示引用当前容器的Bean，”bean2”将输出“Hello Paren!”，表示引用父容器的Bean，如配置有问题请参考cn.javass.spring.chapter3.DependencyInjectTest中的testLocalAndparentBeanInject测试方法。</p>
<h5 id="内部Bean定义"><a href="#内部Bean定义" class="headerlink" title="内部Bean定义"></a>内部Bean定义</h5><p>内部Bean就是在<property>或<constructor-arg>内通过<bean>标签定义的Bean，该Bean不管是否指定id或name，该Bean都会有唯一的匿名标识符，而且不能指定别名，该内部Bean对其他外部Bean不可见，具体配置如下：</bean></constructor-arg></property></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%86%85%E9%83%A8bean.JPG?raw=true" alt=""></p>
<p>（1）让我们写个例子测试一下吧，具体配置文件如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.bean.HelloApiDecorator"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"helloApi"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloApi"</span> <span class="attr">class</span>=<span class="string">"com.zero.spring.chapter.HelloImpl"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> （2）测试代码（cn.javass.spring.chapter3.DependencyInjectTest.testInnerBeanInject）：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTest4</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext context =<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"helloworld.xml"</span>);</span><br><span class="line">        HelloApi bean = context.getBean(<span class="string">"bean"</span>, HelloApi.class);</span><br><span class="line">        bean.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="处理null值"><a href="#处理null值" class="headerlink" title="处理null值"></a>处理null值</h5><p>​        Spring通过<value>标签或value属性注入常量值，所有注入的数据都是字符串，那如何注入null值呢？通过“null”值吗？当然不是因为如果注入“null”则认为是字符串。Spring通过<null>标签注入null值。即可以采用如下配置方式：</null></value></p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%A4%84%E7%90%86null.JPG?raw=true" alt=""></p>
<h5 id="配置简写"><a href="#配置简写" class="headerlink" title="配置简写"></a>配置简写</h5><p>让我们来总结一下依赖注入配置及简写形式，其实我们已经在以上部分穿插着进行简化配置了：</p>
<p> 1）常量值</p>
<p>简写：<constructor-arg index="0" value="常量"></constructor-arg></p>
<p>全写：<constructor-arg index="0"><value>常量</value></constructor-arg></p>
<p>2）引用</p>
<p>简写：<constructor-arg index="0" ref="引用"></constructor-arg></p>
<p>全写：<constructor-arg index="0"><ref bean="引用"></ref></constructor-arg></p>
<p><strong>二、setter**</strong>注入：**      </p>
<p>​       1）常量值</p>
<p>​        简写：<property name="message" value="常量"></property></p>
<p>​        全写：<property name="message"><value>常量</value>&lt;/ property&gt;</property></p>
<p>​       2）引用</p>
<p>​        简写：<property name="message" ref="引用"></property></p>
<p>​        全写：<property name="message"><ref bean="引用">&lt;/ property&gt;</ref></property></p>
<p>​       3）数组：<array>没有简写形式</array></p>
<p>​       4）列表：<list>没有简写形式</list></p>
<p>​       5）集合：<set>没有简写形式</set></p>
<p>​       6）字典</p>
<p>​          简写：<map></map></p>
<p>​             <entry key="键常量" value="值常量"></entry></p>
<p>​             <entry key-ref="键引用" value-ref="值引用"></entry></p>
<p>​            </p>
<p>​         全写：<map></map></p>
<p>​             <entry><key><value>键常量</value></key><value>值常量</value></entry></p>
<p>​             <entry><key><ref bean="键引用"></ref></key><ref bean="值引用"></ref></entry></p>
<p>​           </p>
<p>​       7）Properties：没有简写形式</p>
<p><strong>三、使用p命名空间简化setter注入：</strong></p>
<p>​       使用p命名空间来简化setter注入，具体使用如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span>  <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"  </span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/beans  </span></span></span><br><span class="line"><span class="tag"><span class="string">           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"java.lang.String"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">value</span>=<span class="string">"test"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"idrefBean1"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.IdRefTestBean"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">p:id</span>=<span class="string">"value"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"idrefBean2"</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.IdRefTestBean"</span>  </span></span><br><span class="line"><span class="tag"><span class="attr">p:id-ref</span>=<span class="string">"bean1"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>xmlns:p=”<a href="http://www.springframework.org/schema/p&quot;" target="_blank" rel="noopener">http://www.springframework.org/schema/p&quot;</a></strong> <strong>：首先指定p命名空间；</strong></p>
<p>&lt;bean id=”</p>
</li>
</ul>
<p>……” class=”</p>
<p>……” p:id=”value”/&gt; </p>
<p>：</p>
<p>常量setter注入方式，其等价于<property name="id" value="value">；</property></p>
<p><strong><bean id="……" class="……" p:id-ref="bean1"></bean></strong> <strong>：</strong>引用setter注入方式，其等价于<property name="id" ref="bean1">。 </property></p>
<h4 id="循环依赖"><a href="#循环依赖" class="headerlink" title="循环依赖"></a>循环依赖</h4><h5 id="什么是循环依赖"><a href="#什么是循环依赖" class="headerlink" title="什么是循环依赖"></a>什么是循环依赖</h5><p>循环依赖就是循环引用，就是两个或多个Bean相互之间的持有对方，比如CircleA引用CircleB，CircleB引用CircleC，CircleC引用CircleA，则它们最终反映为一个环。此处不是循环调用，循环调用是方法之间的环调用。如图3-5所示：</p>
<p>循环调用是无法解决的，除非有终结条件，否则就是死循环，最终导致内存溢出错误。 </p>
<p>Spring容器循环依赖包括构造器循环依赖和setter循环依赖，那Spring容器如何解决循环依赖呢？首先让我们来定义循环引用类： </p>
<h4 id="更多DI的知识"><a href="#更多DI的知识" class="headerlink" title="更多DI的知识"></a>更多DI的知识</h4><h5 id="延迟初始化Bean"><a href="#延迟初始化Bean" class="headerlink" title="延迟初始化Bean"></a>延迟初始化Bean</h5><p>延迟初始化也叫做惰性初始化，指不提前初始化Bean，而是只有在真正使用时才创建及初始化Bean。</p>
<p>配置方式很简单只需在<bean>标签上指定“lazy-init” 属性值为“true”即可延迟初始化Bean。<br>Spring容器会在创建容器时提前初始化”singleton”作用域的Bean，”singleton”就是单例的意思即这个容器每个Bean只有一个实例。。Spring容器预先初始化Bean通常能帮助我们提前发现配置错误，所以如果没有什么情况建议开启，除非有某个Bean可能需要加载很大资源，而且很可能在整个应用程序生命周期中很可能使用不到，可以设置为延迟初始化。延迟初始化的Bean通常会在第一次使用时被初始化；或者在被非延迟初始化Bean作为依赖对象注入时在会随着初始化该Bean时被初始化，因为在这时使用了延迟初始化Bean。</bean></p>
<p>容器管理初始化Bean消除了编程实现延迟初始化，完全由容器控制，只需在需要延迟初始化的Bean定义上配置即可，比编程方式更简单，而且是无侵入代码的。具体配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloApi"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.helloworld.HelloImpl"</span></span></span><br><span class="line"><span class="tag"><span class="attr">lazy-init</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="使用depends-on"><a href="#使用depends-on" class="headerlink" title="使用depends-on"></a>使用depends-on</h5><p>depends-on是指指定Bean初始化及销毁时的顺序，使用depends-on属性指定的Bean要先初始化完毕后才初始化当前Bean，由于只有“singleton”Bean能被Spring管理销毁，所以当指定的Bean都是“singleton”时，使用depends-on属性指定的Bean要在指定的Bean之后销毁.</p>
<h5 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h5><p>自动装配就是指由Spring来自动地注入依赖对象，无需人工参与。</p>
<h5 id="方法注入"><a href="#方法注入" class="headerlink" title="方法注入"></a>方法注入</h5><p>所谓方法注入其实就是通过配置方式覆盖或拦截指定的方法，通常通过代理模式实现。Spring提供两种方法注入：查找方法注入和方法替换注入。</p>
<p>因为Spring是通过CGLIB动态代理方式实现方法注入，也就是通过动态修改类的字节码来实现的，本质就是生成需方法注入的类的子类方式实现。</p>
<p>在进行测试之前，我们需要确保将“com.springsource.cn.sf.cglib-2.2.0.jar”放到lib里并添加到“Java Build Path”中的Libararies中。否则报错，异常中包含“nested exception is java.lang.NoClassDefFoundError: cn/sf/cglib/proxy/CallbackFilter<br>”。</p>
<p>传统方式和Spring容器管理方式唯一不同的是不需要我们手动生成子类，而是通过配置方式来实现；其中如果要替换createPrinter()方法的返回值就使用查找方法注入；如果想完全替换sayHello()方法体就使用方法替换注入。接下来让我们看看具体实现吧。</p>
<h4 id="Bean的作用域"><a href="#Bean的作用域" class="headerlink" title="Bean的作用域"></a>Bean的作用域</h4><p>什么是作用域呢？即“scope”，在面向对象程序设计中一般指对象或变量之间的可见范围。而在Spring容器中是指其创建的Bean对象相对于其他Bean对象的请求可见范围。<br>Spring提供“singleton”和“prototype”两种基本作用域，另外提供“request”、“session”、“global session”三种web作用域；Spring还允许用户定制自己的作用域。</p>
<h5 id="基本的作用域"><a href="#基本的作用域" class="headerlink" title="基本的作用域"></a>基本的作用域</h5><p>一、singleton：指“singleton”作用域的Bean只会在每个Spring IoC容器中存在一个实例，而且其完整生命周期完全由Spring容器管理。对于所有获取该Bean的操作Spring容器将只返回同一个Bean。</p>
<table>
<thead>
<tr>
<th>Gof单例设计模式</th>
</tr>
</thead>
<tbody>
<tr>
<td>GoF单例设计模式指“保证一个类仅有一个实例，并提供一个访问它的全局访问点”，介绍了两种实现：通过在类上<strong>定义静态属性</strong>保持该实例和通过注册表方式。</td>
</tr>
</tbody>
</table>
<p><strong>(1)通过在类上定义静态属性保持该实例：</strong>一般指一个Java虚拟机 ClassLoader装载的类只有一个实例，一般通过类静态属性保持该实例，这样就造成需要单例的类都需要按照单例设计模式进行编码；Spring没采用这种方式，因为该方式属于侵入式设计；代码样例如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3.bean;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;  </span><br><span class="line">    <span class="comment">//1.私有化构造器  </span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;  </span><br><span class="line">    <span class="comment">//2.单例缓存者，惰性初始化，第一次使用时初始化  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceHolder</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE = <span class="keyword">new</span> Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//3.提供全局访问点  </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> InstanceHolder.INSTANCE;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">//4.提供一个计数器来验证一个ClassLoader一个实例  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> counter=<span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上定义个了个单例类，首先要私有化类构造器；其次使用InstanceHolder静态内部类持有单例对象，这样可以得到惰性初始化好处；最后提供全局访问点getInstance，使得需要该单例实例的对象能获取到；我们在此还提供了一个counter计数器来验证一个ClassLoader一个实例。具体一个ClassLoader有一个单例实例测试请参考代码“cn.javass.spring.chapter3. SingletonTest”中的“testSingleton”测试方法，里边详细演示了一个ClassLoader有一个单例实例。</p>
<p> (2) <strong>通过注册表方式：</strong> 首先将需要单例的实例通过唯一键注册到注册表，然后通过键来获取单例，让我们直接看实现吧，注意本注册表实现了Spring接口“SingletonBeanRegistry”，该接口定义了操作共享的单例对象，Spring容器实现将实现此接口；所以共享单例对象通过“registerSingleton”方法注册，通过“getSingleton”方法获取，消除了编程方式单例，注意在实现中不考虑并发： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.SingletonBeanRegistry;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonBeanRegister</span> <span class="keyword">implements</span> <span class="title">SingletonBeanRegistry</span> </span>&#123;  </span><br><span class="line">    <span class="comment">//单例Bean缓存池，此处不考虑并发  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; BEANS = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsSingleton</span><span class="params">(String beanName)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> BEANS.containsKey(beanName);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getSingleton</span><span class="params">(String beanName)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> BEANS.get(beanName);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSingletonCount</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> BEANS.size();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> String[] getSingletonNames() &#123;  </span><br><span class="line">        <span class="keyword">return</span> BEANS.keySet().toArray(<span class="keyword">new</span> String[<span class="number">0</span>]);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerSingleton</span><span class="params">(String beanName, Object bean)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(BEANS.containsKey(beanName)) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"["</span> + beanName + <span class="string">"] 已存在"</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        BEANS.put(beanName, bean);  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring是注册表单例设计模式的实现，消除了编程式单例，而且对代码是非入侵式。</p>
<p> 接下来让我们看看在Spring中如何配置单例Bean吧，在Spring容器中如果没指定作用域默认就是“singleton”，配置方式通过scope属性配置，具体配置如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.Printer"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>​       Spring管理单例对象在Spring容器中存储如图3-5所示，Spring不仅会缓存单例对象，Bean定义也是会缓存的，对于惰性初始化的对象是在首次使用时根据Bean定义创建并存放于单例缓存池。</p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8D%95%E4%BE%8B%E5%A4%84%E7%90%86.JPG?raw=true" alt=""></p>
<p>图3-5 单例处理</p>
<p> <strong>二、prototype：</strong>即原型，指每次向Spring容器请求获取Bean都返回一个全新的Bean，相对于“singleton”来说就是不缓存Bean，每次都是一个根据Bean定义创建的全新Bean。</p>
<blockquote>
<p>GoF原型设计模式，指用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p>
</blockquote>
<p> Spring中的原型和GoF中介绍的原型含义是不一样的：</p>
<p>​          GoF通过用原型实例指定创建对象的种类，而Spring容器用Bean定义指定创建对象的种类；</p>
<p>​          GoF通过拷贝这些原型创建新的对象，而Spring容器根据Bean定义创建新对象。</p>
<p> 其相同地方都是根据某些东西创建新东西，而且GoF原型必须显示实现克隆操作，属于侵入式，而Spring容器只需配置即可，属于非侵入式。</p>
<p> 接下来让我们看看Spring如何实现原型呢？</p>
<p> 1）首先让我们来定义Bean“原型”：Bean定义，所有对象将根据Bean定义创建；在此我们只是简单示例一下，不会涉及依赖注入等复杂实现：BeanDefinition类定义属性“class”表示原型类，“id”表示唯一标识，“scope”表示作用域，具体如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanDefinition</span> </span>&#123;  </span><br><span class="line">    <span class="comment">//单例  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCOPE_SINGLETON = <span class="number">0</span>;  </span><br><span class="line">    <span class="comment">//原型  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SCOPE_PROTOTYPE = <span class="number">1</span>;  </span><br><span class="line">    <span class="comment">//唯一标识  </span></span><br><span class="line">    <span class="keyword">private</span> String id;  </span><br><span class="line">    <span class="comment">//class全限定名  </span></span><br><span class="line">    <span class="keyword">private</span> String clazz;  </span><br><span class="line">    <span class="comment">//作用域  </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> scope = SCOPE_SINGLETON;  </span><br><span class="line">    <span class="comment">//鉴于篇幅，省略setter和getter方法；  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2）接下来让我们看看Bean定义注册表，类似于单例注册表：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanDifinitionRegister</span> </span>&#123;  </span><br><span class="line">    <span class="comment">//bean定义缓存，此处不考虑并发问题  </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, BeanDefinition&gt; DEFINITIONS =  </span><br><span class="line"> <span class="keyword">new</span> HashMap&lt;String, BeanDefinition&gt;();  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(String beanName, BeanDefinition bd)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//1.本实现不允许覆盖Bean定义  </span></span><br><span class="line">        <span class="keyword">if</span>(DEFINITIONS.containsKey(bd.getId())) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"已存在Bean定义，此实现不允许覆盖"</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">//2.将Bean定义放入Bean定义缓存池  </span></span><br><span class="line">        DEFINITIONS.put(bd.getId(), bd);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanDefinition <span class="title">getBeanDefinition</span><span class="params">(String beanName)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> DEFINITIONS.get(beanName);  </span><br><span class="line">    &#125;  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsBeanDefinition</span><span class="params">(String beanName)</span> </span>&#123;        </span><br><span class="line"> <span class="keyword">return</span> DEFINITIONS.containsKey(beanName);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3）接下来应该来定义BeanFactory了：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.SingletonBeanRegistry;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultBeanFactory</span> </span>&#123;  </span><br><span class="line">    <span class="comment">//Bean定义注册表  </span></span><br><span class="line">    <span class="keyword">private</span> BeanDifinitionRegister DEFINITIONS = <span class="keyword">new</span> BeanDifinitionRegister();  </span><br><span class="line">   </span><br><span class="line">    <span class="comment">//单例注册表  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SingletonBeanRegistry SINGLETONS = <span class="keyword">new</span> SingletonBeanRegister();  </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getBean</span><span class="params">(String beanName)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//1.验证Bean定义是否存在  </span></span><br><span class="line">        <span class="keyword">if</span>(!DEFINITIONS.containsBeanDefinition(beanName)) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"不存在["</span> + beanName + <span class="string">"]Bean定义"</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">//2.获取Bean定义  </span></span><br><span class="line">        BeanDefinition bd = DEFINITIONS.getBeanDefinition(beanName);  </span><br><span class="line">        <span class="comment">//3.是否该Bean定义是单例作用域  </span></span><br><span class="line">        <span class="keyword">if</span>(bd.getScope() == BeanDefinition.SCOPE_SINGLETON) &#123;  </span><br><span class="line">            <span class="comment">//3.1 如果单例注册表包含Bean，则直接返回该Bean  </span></span><br><span class="line">            <span class="keyword">if</span>(SINGLETONS.containsSingleton(beanName)) &#123;  </span><br><span class="line">                <span class="keyword">return</span> SINGLETONS.getSingleton(beanName);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="comment">//3.2单例注册表不包含该Bean，  </span></span><br><span class="line">            <span class="comment">//则创建并注册到单例注册表，从而缓存  </span></span><br><span class="line">            SINGLETONS.registerSingleton(beanName, createBean(bd));  </span><br><span class="line">            <span class="keyword">return</span> SINGLETONS.getSingleton(beanName);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">//4.如果是原型Bean定义,则直接返回根据Bean定义创建的新Bean，  </span></span><br><span class="line"><span class="comment">//每次都是新的，无缓存  </span></span><br><span class="line">        <span class="keyword">if</span>(bd.getScope() == BeanDefinition.SCOPE_PROTOTYPE) &#123;  </span><br><span class="line">            <span class="keyword">return</span> createBean(bd);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">//5.其他情况错误的Bean定义  </span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"错误的Bean定义"</span>);  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(BeanDefinition bd)</span> </span>&#123;  </span><br><span class="line">     DEFINITIONS.registerBeanDefinition(bd.getId(), bd);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> <span class="function"><span class="keyword">private</span> Object <span class="title">createBean</span><span class="params">(BeanDefinition bd)</span> </span>&#123;  </span><br><span class="line">     <span class="comment">//根据Bean定义创建Bean  </span></span><br><span class="line">     <span class="keyword">try</span> &#123;  </span><br><span class="line">         Class clazz = Class.forName(bd.getClazz());  </span><br><span class="line">         <span class="comment">//通过反射使用无参数构造器创建Bean  </span></span><br><span class="line">         <span class="keyword">return</span> clazz.getConstructor().newInstance();  </span><br><span class="line">     &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;  </span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"没有找到Bean["</span> + bd.getId() + <span class="string">"]类"</span>);  </span><br><span class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"创建Bean["</span> + bd.getId() + <span class="string">"]失败"</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>​       其中方法getBean用于获取根据beanName对于的Bean定义创建的对象，有单例和原型两类Bean；registerBeanDefinition方法用于注册Bean定义，私有方法createBean用于根据Bean定义中的类型信息创建Bean。</p>
<p> 3）测试一下吧，在此我们只测试原型作用域Bean，对于每次从Bean工厂中获取的Bean都是一个全新的对象，代码片段（BeanFatoryTest）如下：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPrototype</span> <span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line"><span class="comment">//1.创建Bean工厂  </span></span><br><span class="line">DefaultBeanFactory bf = <span class="keyword">new</span> DefaultBeanFactory();  </span><br><span class="line"><span class="comment">//2.创建原型 Bean定义  </span></span><br><span class="line">BeanDefinition bd = <span class="keyword">new</span> BeanDefinition();  </span><br><span class="line">bd.setId(<span class="string">"bean"</span>);  </span><br><span class="line">bd.setScope(BeanDefinition.SCOPE_PROTOTYPE);  </span><br><span class="line">bd.setClazz(HelloImpl2.class.getName());  </span><br><span class="line">bf.registerBeanDefinition(bd);  </span><br><span class="line"><span class="comment">//对于原型Bean每次应该返回一个全新的Bean  </span></span><br><span class="line">System.out.println(bf.getBean(<span class="string">"bean"</span>) != bf.getBean(<span class="string">"bean"</span>));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后让我们看看如何在Spring中进行配置吧，只需指定<bean>标签属性“scope”属性为“prototype”即可：</bean></p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.bean.Printer"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>​       Spring管理原型对象在Spring容器中存储如图3-6所示，Spring不会缓存原型对象，而是根据Bean定义每次请求返回一个全新的Bean：</p>
<p> <img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Spring/%E5%8E%9F%E5%9E%8B%E5%A4%84%E7%90%86.JPG?raw=true" alt=""></p>
<p>图3-6 原型处理</p>
<p>​        单例和原型作用域我们已经讲完，接下来让我们学习一些在Web应用中有哪些作用域：</p>
<h5 id="Web应用中的作用域"><a href="#Web应用中的作用域" class="headerlink" title="Web应用中的作用域"></a>Web应用中的作用域</h5><p>在Web应用中，我们可能需要将数据存储到request、session、global session。因此Spring提供了三种Web作用域：request、session、globalSession。</p>
<p> <strong>一、request作用域：表示每个请求需要容器创建一个全新Bean</strong>。比如提交表单的数据必须是对每次请求新建一个Bean来保持这些表单数据，请求结束释放这些数据。</p>
<p> <strong>二、session作用域：表示每个会话需要容器创建一个全新Bean</strong>。比如对于每个用户一般会有一个会话，该用户的用户信息需要存储到会话中，此时可以将该Bean配置为web作用域。</p>
<p> <strong>三、globalSession：</strong>类似于session作用域，只是其用于portlet环境的web应用。如果在非portlet环境将视为session作用域。</p>
<p>配置方式和基本的作用域相同，只是必须要有web环境支持，并配置相应的容器监听器或拦截器从而能应用这些作用域，我们会在集成web时讲解具体使用，大家只需要知道有这些作用域就可以了。</p>
<h5 id="自定义作用域"><a href="#自定义作用域" class="headerlink" title="自定义作用域"></a>自定义作用域</h5><p> 在日常程序开发中，几乎用不到自定义作用域，除非又必要才进行自定义作用域。</p>
<p> 首先让我们看下Scope接口吧：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.beans.factory.config;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.ObjectFactory;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Scope</span> </span>&#123;  </span><br><span class="line">       <span class="function">Object <span class="title">get</span><span class="params">(String name, ObjectFactory&lt;?&gt; objectFactory)</span></span>;  </span><br><span class="line">       <span class="function">Object <span class="title">remove</span><span class="params">(String name)</span></span>;  </span><br><span class="line">       <span class="function"><span class="keyword">void</span> <span class="title">registerDestructionCallback</span><span class="params">(String name, Runnable callback)</span></span>;  </span><br><span class="line">       <span class="function">Object <span class="title">resolveContextualObject</span><span class="params">(String key)</span></span>;  </span><br><span class="line">       <span class="function">String <span class="title">getConversationId</span><span class="params">()</span></span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1）<strong>Object get(String name, ObjectFactory&lt;?&gt; objectFactory)：</strong>用于从作用域中获取Bean，其中参数objectFactory是当在当前作用域没找到合适Bean时使用它创建一个新的Bean；</p>
<p>2）<strong>void registerDestructionCallback(String name, Runnable callback)：</strong>用于注册销毁回调，如果想要销毁相应的对象则由Spring容器注册相应的销毁回调，而由自定义作用域选择是不是要销毁相应的对象；</p>
<p>3）<strong>Object resolveContextualObject(String key)</strong>：用于解析相应的上下文数据，比如request作用域将返回request中的属性。</p>
<p>4）<strong>String getConversationId()</strong>：作用域的会话标识，比如session作用域将是sessionId。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3;  </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;  </span><br><span class="line"><span class="keyword">import</span> java.util.Map;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.ObjectFactory;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.Scope;  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadScope</span> <span class="keyword">implements</span> <span class="title">Scope</span> </span>&#123;  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ThreadLocal&lt;Map&lt;String, Object&gt;&gt; THREAD_SCOPE =  </span><br><span class="line"><span class="keyword">new</span> ThreadLocal&lt;Map&lt;String, Object&gt;&gt;() &#123;  </span><br><span class="line">      <span class="function"><span class="keyword">protected</span> Map&lt;String, Object&gt; <span class="title">initialValue</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">          <span class="comment">//用于存放线程相关Bean  </span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> HashMap&lt;String, Object&gt;();  </span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>​       让我们来实现个简单的thread作用域，该作用域内创建的对象将绑定到ThreadLocal内。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String name, ObjectFactory&lt;?&gt; objectFactory)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//如果当前线程已经绑定了相应Bean，直接返回  </span></span><br><span class="line">        <span class="keyword">if</span>(THREAD_SCOPE.get().containsKey(name)) &#123;  </span><br><span class="line">           <span class="keyword">return</span> THREAD_SCOPE.get().get(name);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">//使用objectFactory创建Bean并绑定到当前线程上  </span></span><br><span class="line">        THREAD_SCOPE.get().put(name, objectFactory.getObject());  </span><br><span class="line">        <span class="keyword">return</span> THREAD_SCOPE.get().get(name);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConversationId</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerDestructionCallback</span><span class="params">(String name, Runnable callback)</span> </span>&#123;  </span><br><span class="line">        <span class="comment">//此处不实现就代表类似proytotype，容器返回给用户后就不管了  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">remove</span><span class="params">(String name)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> THREAD_SCOPE.get().remove(name);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">resolveContextualObject</span><span class="params">(String key)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Scope已经实现了，让我们将其注册到Spring容器，使其发挥作用：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.CustomScopeConfigurer"</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"scopes"</span>&gt;</span>  </span><br><span class="line">           <span class="tag">&lt;<span class="name">map</span>&gt;</span><span class="tag">&lt;<span class="name">entry</span>&gt;</span>  </span><br><span class="line">                   <span class="comment">&lt;!-- 指定scope关键字 --&gt;</span><span class="tag">&lt;<span class="name">key</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span>  </span><br><span class="line">                   <span class="comment">&lt;!-- scope实现 --&gt;</span>      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter3.ThreadScope"</span>/&gt;</span>  </span><br><span class="line">           <span class="tag">&lt;/<span class="name">entry</span>&gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span>      </span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过CustomScopeConfigurer的scopes属性注册自定义作用域实现，在此需要指定使用作用域的关键字“thread”，并指定自定义作用域实现。来让我们来定义一个“thread”作用域的Bean，配置（chapter3/threadScope.xml）如下：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloApi"</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"cn.javass.spring.chapter2.helloworld.HelloImpl"</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">scope</span>=<span class="string">"thread"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后测试（cn.javass.spring.chapter3.ThreadScopeTest）一下吧，首先在一个线程中测试，在同一线程中获取的Bean应该是一样的；再让我们开启两个线程，然后应该这两个线程创建的Bean是不一样：</p>
<p> 自定义作用域实现其实是非常简单的，其实复杂的是如果需要销毁Bean，自定义作用域如何正确的销毁Bean。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Spring/" rel="tag"># Spring</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/21/单元测试/" rel="next" title="Junit">
                <i class="fa fa-chevron-left"></i> Junit
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/23/日志相关/" rel="prev" title="日志相关">
                日志相关 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">48</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring概述"><span class="nav-number">1.</span> <span class="nav-text">Spring概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring是什么？"><span class="nav-number">1.1.</span> <span class="nav-text">Spring是什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring能帮我们做什么"><span class="nav-number">1.2.</span> <span class="nav-text">Spring能帮我们做什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为何需要Spring？"><span class="nav-number">1.3.</span> <span class="nav-text">为何需要Spring？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如何学好Spring？"><span class="nav-number">1.4.</span> <span class="nav-text">如何学好Spring？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring基础"><span class="nav-number">1.5.</span> <span class="nav-text">Spring基础</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#典型应用场景"><span class="nav-number">1.6.</span> <span class="nav-text">典型应用场景</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IoC"><span class="nav-number">2.</span> <span class="nav-text">IoC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IoC基础"><span class="nav-number">2.1.</span> <span class="nav-text">IoC基础</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#IoC是什么"><span class="nav-number">2.1.1.</span> <span class="nav-text">IoC是什么</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IoC能做什么"><span class="nav-number">2.1.2.</span> <span class="nav-text">IoC能做什么</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IoC和DI"><span class="nav-number">2.1.3.</span> <span class="nav-text">IoC和DI</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IoC容器基本原理"><span class="nav-number">2.2.</span> <span class="nav-text">IoC容器基本原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Ioc容器的概念"><span class="nav-number">2.2.1.</span> <span class="nav-text">Ioc容器的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Bean的概念"><span class="nav-number">2.2.2.</span> <span class="nav-text">Bean的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hello-World"><span class="nav-number">2.2.3.</span> <span class="nav-text">Hello World</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#详解IoC"><span class="nav-number">2.2.4.</span> <span class="nav-text">详解IoC</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#小结："><span class="nav-number">2.2.5.</span> <span class="nav-text">小结：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IoC的配置使用"><span class="nav-number">2.3.</span> <span class="nav-text">IoC的配置使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#XML配置的结构"><span class="nav-number">2.3.1.</span> <span class="nav-text">XML配置的结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Bean的配置"><span class="nav-number">2.3.2.</span> <span class="nav-text">Bean的配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Bean的命名"><span class="nav-number">2.3.3.</span> <span class="nav-text">Bean的命名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#实例化Bean"><span class="nav-number">2.3.4.</span> <span class="nav-text">实例化Bean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#小结"><span class="nav-number">2.3.5.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DI的配置使用"><span class="nav-number">3.</span> <span class="nav-text">DI的配置使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#依赖和依赖注入"><span class="nav-number">3.1.</span> <span class="nav-text">依赖和依赖注入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#构造器注入"><span class="nav-number">3.1.1.</span> <span class="nav-text">构造器注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#setter注入"><span class="nav-number">3.1.2.</span> <span class="nav-text">setter注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注入常量"><span class="nav-number">3.1.3.</span> <span class="nav-text">注入常量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注入常量是依赖注入中最简单的。配置方式如下所示："><span class="nav-number">3.1.4.</span> <span class="nav-text">注入常量是依赖注入中最简单的。配置方式如下所示：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注入Bean-ID"><span class="nav-number">3.1.5.</span> <span class="nav-text">注入Bean ID</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注入集合、数组和字典"><span class="nav-number">3.1.6.</span> <span class="nav-text">注入集合、数组和字典</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#引用其它Bean"><span class="nav-number">3.1.7.</span> <span class="nav-text">引用其它Bean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#内部Bean定义"><span class="nav-number">3.1.8.</span> <span class="nav-text">内部Bean定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#处理null值"><span class="nav-number">3.1.9.</span> <span class="nav-text">处理null值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置简写"><span class="nav-number">3.1.10.</span> <span class="nav-text">配置简写</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#循环依赖"><span class="nav-number">3.2.</span> <span class="nav-text">循环依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#什么是循环依赖"><span class="nav-number">3.2.1.</span> <span class="nav-text">什么是循环依赖</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更多DI的知识"><span class="nav-number">3.3.</span> <span class="nav-text">更多DI的知识</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#延迟初始化Bean"><span class="nav-number">3.3.1.</span> <span class="nav-text">延迟初始化Bean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用depends-on"><span class="nav-number">3.3.2.</span> <span class="nav-text">使用depends-on</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自动装配"><span class="nav-number">3.3.3.</span> <span class="nav-text">自动装配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法注入"><span class="nav-number">3.3.4.</span> <span class="nav-text">方法注入</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean的作用域"><span class="nav-number">3.4.</span> <span class="nav-text">Bean的作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基本的作用域"><span class="nav-number">3.4.1.</span> <span class="nav-text">基本的作用域</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Web应用中的作用域"><span class="nav-number">3.4.2.</span> <span class="nav-text">Web应用中的作用域</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义作用域"><span class="nav-number">3.4.3.</span> <span class="nav-text">自定义作用域</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
