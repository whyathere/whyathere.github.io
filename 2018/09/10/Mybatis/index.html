<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Mybatis," />










<meta name="description" content="全局参数配置批量起别名123&amp;lt;typeAliases&amp;gt;    &amp;lt;package name=&quot;com.zero.dao&quot;/&amp;gt;&amp;lt;/typeAliases&amp;gt; 123456&amp;lt;settings&amp;gt;    &amp;lt;!--默认是OTHER这里改为NULL--&amp;gt;    &amp;lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot;">
<meta name="keywords" content="Mybatis">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis">
<meta property="og:url" content="http://yoursite.com/2018/09/10/Mybatis/index.html">
<meta property="og:site_name" content="Bill">
<meta property="og:description" content="全局参数配置批量起别名123&amp;lt;typeAliases&amp;gt;    &amp;lt;package name=&quot;com.zero.dao&quot;/&amp;gt;&amp;lt;/typeAliases&amp;gt; 123456&amp;lt;settings&amp;gt;    &amp;lt;!--默认是OTHER这里改为NULL--&amp;gt;    &amp;lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Mybatis/found%EF%BC%9A2.png?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/Java%E5%9F%BA%E7%A1%80/databaseProvider.png?raw=true">
<meta property="og:image" content="https://github.com/whyathere/tuchuang/blob/master/Java%E5%9F%BA%E7%A1%80/select.png?raw=true">
<meta property="og:updated_time" content="2019-02-09T03:55:49.380Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mybatis">
<meta name="twitter:description" content="全局参数配置批量起别名123&amp;lt;typeAliases&amp;gt;    &amp;lt;package name=&quot;com.zero.dao&quot;/&amp;gt;&amp;lt;/typeAliases&amp;gt; 123456&amp;lt;settings&amp;gt;    &amp;lt;!--默认是OTHER这里改为NULL--&amp;gt;    &amp;lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot;">
<meta name="twitter:image" content="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Mybatis/found%EF%BC%9A2.png?raw=true">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/09/10/Mybatis/"/>





  <title>Mybatis | Bill</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bill</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/10/Mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bill">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Mybatis</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-10T18:27:21+08:00">
                2018-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/框架/" itemprop="url" rel="index">
                    <span itemprop="name">框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="全局参数配置"><a href="#全局参数配置" class="headerlink" title="全局参数配置"></a>全局参数配置</h3><h4 id="批量起别名"><a href="#批量起别名" class="headerlink" title="批量起别名"></a>批量起别名</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.zero.dao"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--默认是OTHER这里改为NULL--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"jdbcTypeForNull"</span> <span class="attr">value</span>=<span class="string">"NULL"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启驼峰命名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Mybatis参数"><a href="#Mybatis参数" class="headerlink" title="Mybatis参数"></a>Mybatis参数</h3><h4 id="主要参数的意义"><a href="#主要参数的意义" class="headerlink" title="主要参数的意义"></a>主要参数的意义</h4><p>property:对应到javaBean中的值</p>
<p>column:指定数据库中那一列的值</p>
<p>javaType:列值对应的java类型</p>
<p>discriminator:标签鉴别器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--获取自增主键的值</span></span><br><span class="line"><span class="comment">    useGeneratedKeys 使用自增主键获取主键值策略</span></span><br><span class="line"><span class="comment">    keyProperty : 指定对应的主键属性，也就是mybatis获取到主键值以后，将这个值封装给javaBean的那个属性</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmployee"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">    insert into tb_user (name,address)</span><br><span class="line">    values</span><br><span class="line">    (#&#123;name&#125;,#&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Param"><a href="#Param" class="headerlink" title="@Param"></a>@Param</h4><p>多个参数会被封装成一个map，#{}就是从map中获取指定的key的值。</p>
<p>key是param</p>
<p>value是传入的值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogByIdAndName"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">    select * from tb_user where id = #&#123;param1&#125; and name = #&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>多个参数的时候可以命名参数：明确指定封装参数时map的key。@Param(“”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Blog <span class="title">getBlogByIdAndName</span><span class="params">(@Param(<span class="string">"id"</span>)</span> Integer id, @<span class="title">Param</span><span class="params">(<span class="string">"name"</span>)</span> String name)</span>;</span><br></pre></td></tr></table></figure>
<p>key：使用@Param注解指定的值</p>
<p>value:参数值</p>
<p>#{指定的key}取出对应的参数值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogByIdAndName"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">    select * from tb_user where id = #&#123;id&#125; and name = #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span>d</span><br></pre></td></tr></table></figure>
<h4 id="以Map为参数集合"><a href="#以Map为参数集合" class="headerlink" title="以Map为参数集合"></a>以Map为参数集合</h4><p>如果多个参数正好是我们业务逻辑的数据模型，我们就可以直接传入pojo</p>
<p>#{属性名}：取出传入pojo的属性值</p>
<p>如果多个参数不是业务模型中的数据，没有对应的pojo，不经常使用为了方便，我们可以传入map</p>
<p>#{key}:取出map中对应的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Blog <span class="title">getBlogByMap</span><span class="params">(Map&lt;String,String&gt; map)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogByMap"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">    select *  from tb_user where id = #&#123;id&#125; and name = #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">"id"</span>,<span class="string">"4"</span>);</span><br><span class="line">map.put(<span class="string">"name"</span>,<span class="string">"zhangsan"</span>);</span><br><span class="line">Blog blog = mapper.getBlogByMap(map);</span><br></pre></td></tr></table></figure>
<h4 id="编写专门的TO"><a href="#编写专门的TO" class="headerlink" title="编写专门的TO"></a>编写专门的TO</h4><p>如果多个参数不是业务模型中的数据，但是经常要使用，推荐来编写一个TO(Transfer Object)数据传入对象</p>
<p>Page{</p>
<p>​    int index;</p>
<p>​    int size;</p>
<p>}</p>
<h4 id="传参处理"><a href="#传参处理" class="headerlink" title="传参处理"></a>传参处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Blog <span class="title">getBlog</span><span class="params">(@Param(<span class="string">"id"</span>)</span> Integer id,  String name)</span>;</span><br></pre></td></tr></table></figure>
<p>取值：id==&gt;#{id/param1}   name ==&gt; #{param2}</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Blog <span class="title">getBlog</span><span class="params">(Integer id,  @Param(<span class="string">"e"</span>)</span>Blog blog)</span>;</span><br></pre></td></tr></table></figure>
<p>取值：id ==&gt; #{param1}   name ==&gt;  #{param2.name/e.name}</p>
<p>特别注意：如果是Collection (List、Set) 类型或者数组，也会特殊处理。也是把传入的list或者数组封装在map中，</p>
<p>key：Collection(collection),如果是List还可以使用这个key(list)</p>
<p>数组(array)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Blog <span class="title">getBlogById</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br></pre></td></tr></table></figure>
<p>取值：取出第一个id的值: #{list[0]}   不能写ids或者param1</p>
<h3 id="和-取值"><a href="#和-取值" class="headerlink" title="#和$取值"></a>#和$取值</h3><p>#{}和${}都可以取map或者pojo的值</p>
   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> tb_blog <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">2</span> <span class="keyword">and</span> <span class="keyword">name</span> = ?</span><br></pre></td></tr></table></figure>
<p>区别：</p>
<p>​    #{}：是以预编译的形式，将参数设置到sql语句中；？PreparedStatement  防止sql注入</p>
<p>​    ${}：取出的值直接拼装在sql语句中；会有安全问题，无法防止sql注入</p>
<p>大多情况下取参数的值都应该使用#{}；</p>
<p>比如分表、排序：按照年份拆分</p>
<p>​    select * from 2016(2017)_year</p>
<p>年份不确定，原生jdbc不支持占位符的地方我们可以使用${}进行取值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> $&#123;<span class="keyword">year</span>&#125;_salary <span class="keyword">where</span> xxx;</span><br></pre></td></tr></table></figure>
<p>#{}只能取出参数中的值</p>
<p>#{}：更丰富的用法：</p>
<p>规定参数的一些规则：</p>
<p>javaType、jdbcType、mode(存储过程)、numericScale、</p>
<p>resultMap、typeHandler、jdbcTypeName、expression</p>
<p>jdbcType：通常要在某种特定的条件下设置；</p>
<p>​    在我们的数据为null的时候，有些数据库可能不能识别mybatis对null的默认处理。比如oracle：为null时会报错，这个时候要处理这个报错告知mybatis。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Blog blog = <span class="keyword">new</span> Blog(<span class="keyword">null</span>,<span class="string">"lisi"</span>,<span class="string">"null"</span>);</span><br><span class="line">mapper.addBlog(blog);</span><br></pre></td></tr></table></figure>
<p>​    如果是oracle会报错：无效的类型。不能区分出null的类型。JdbcType OTHER：无效的类型</p>
<p>而mysql的没有问题的。因为mybatis对所有的null都映射的是JDBC OTHER类型。</p>
<p>当jdbcType为null时，默认为OTHER。这个OTHER  oracle不认识。由于全局配置中，jdbcTypeForNull = OTHER</p>
<p>1、#{enmail,jdbcType=OTHER} 只会影响当前sql语句的jdbcType</p>
<p>2、直接改全局配置，将全部的jdbcTypeForNull改为null</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--默认是OTHER这里改为NULL--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"jdbcTypeForNull"</span> <span class="attr">value</span>=<span class="string">"NULL"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个NULL，oracle和mysql都可识别。</p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>select元素来定义查询操作</p>
<p>id:唯一标识符</p>
<p>-用来引用这条语句，需要和接口的方法名一致</p>
<p>parameterType：参数类型</p>
<p>-可以不传，Mybatis会根据TypeHandler自动推断</p>
<p>resultType：返回值类型</p>
<p>-别名或者全类名，如果返回的是集合，定义集合中元素的类型。不能和resultMap同时使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Blog&gt; <span class="title">getBlogByNameLike</span><span class="params">(String name)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--resultType:如果返回值类型是一个集合，要写集合中元素的类型--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogByNameLike"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">  select * from tb_user where name like #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">            BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line"><span class="comment">//            Blog blog = new Blog(null,"zhangsan","Beijing");</span></span><br><span class="line">            List&lt;Blog&gt; like = mapper.getBlogByNameLike(<span class="string">"%z%"</span>);</span><br><span class="line">            <span class="keyword">for</span> (Blog blog : like)&#123;</span><br><span class="line">                System.out.println(blog);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>resultType为com.zero.dao.Blog时，jdbc会将数据封装为Blog然后返回。</p>
<h4 id="select记录封装map"><a href="#select记录封装map" class="headerlink" title="select记录封装map"></a>select记录封装map</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapKey</span>(<span class="string">"name"</span>)</span><br><span class="line"><span class="comment">//告诉mybatis封装这个map的时候使用哪个属性作为map的key</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Blog&gt; <span class="title">getBlogByNameLikeReturnMap</span><span class="params">(String name)</span></span>;</span><br></pre></td></tr></table></figure>
<p>@MapKey是指定封装这个map的时候哪个属性作为封装Map的key</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Map&lt;String,Blog&gt;   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogByNameLikeReturnMap"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">    select * from tb_user where name like #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Blog&gt; map = mapper.getBlogByNameLikeReturnMap(<span class="string">"%w%"</span>);</span><br></pre></td></tr></table></figure>
<h4 id="自定义结果映射规则-resultMap"><a href="#自定义结果映射规则-resultMap" class="headerlink" title="自定义结果映射规则 resultMap"></a>自定义结果映射规则 resultMap</h4><ol>
<li><p>如果查出的列明和javaBean的属性名不一样，需要写别名，或者如果符合驼峰命名法则开启驼峰命名</p>
<ul>
<li><p>autoMappingBehavior默认是PARTIAL，开启自动映射的功能。唯一的要求是列名和javaBean属性名一致</p>
</li>
<li><p>如果autoMappingBehavior设置为null则会取消自动映射</p>
</li>
<li><p>数据库字段命名规范，POJO属性符合驼峰命名法，如A_COLUMN-&gt;aColumn，我们可以开启自动驼峰命名规则映射功能</p>
</li>
<li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启驼峰命名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<p>此外resultMap还可以指定自定义结果集映射规则</p>
<p>如何定义规则：在该mapper标签中最上面自定义某个javaBean的封装规则</p>
<p>如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zero.dao.BlogMapperPlus"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自定义某个javaBean的封装规则</span></span><br><span class="line"><span class="comment">        type：自定义规则的Java类型</span></span><br><span class="line"><span class="comment">        id：唯一id方便引用</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyBlog"</span> <span class="attr">type</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定主键的封装规则</span></span><br><span class="line"><span class="comment">        id：定义主键会底层有优化</span></span><br><span class="line"><span class="comment">        column:指定那一列</span></span><br><span class="line"><span class="comment">        property：指定对应的javaBean属性</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义普通列封装规则--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--其他不指定的列会自动封装，但是只要写resultMap就要把全部的映射规则都写上--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogById"</span> <span class="attr">resultMap</span>=<span class="string">"MyBlog"</span>&gt;</span></span><br><span class="line">        select * from tb_user where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="resultMap关联查询"><a href="#resultMap关联查询" class="headerlink" title="resultMap关联查询"></a>resultMap关联查询</h4><p>如果Blog中包含部门对象</p>
<p>现在的要求是在查出这个对象的同时查出其所在的部门</p>
<p>Department</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tbl_dept(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">11</span>) PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">dept_name <span class="built_in">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_user <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> d_id <span class="built_in">INT</span>(<span class="number">11</span>);</span><br></pre></td></tr></table></figure>
<p>创建tbl_dept表并为tb_user表添加一列d_id</p>
<p>现在为tb_user的d_id属性添加外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_user <span class="keyword">add</span> <span class="keyword">CONSTRAINT</span> fk_user_dept</span><br><span class="line">FOREIGN <span class="keyword">KEY</span>(d_id) <span class="keyword">REFERENCES</span> tbl_dept(<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>
<p>外键名称为fk_user_dept，将d_id的外键设置为tbl_dept的id属性。</p>
<p>此时想要查询出所有信息有两种方法：</p>
<p>1、外键关联</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--联合查询：级联属性封装结果--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyResult"</span> <span class="attr">type</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--可以指定联合的javaBean对象</span></span><br><span class="line"><span class="comment">        property="dept" 指定那个属性是联合对象</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"did"</span> <span class="attr">property</span>=<span class="string">"dept.id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"dept.departmentName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogAndDeptById"</span> <span class="attr">resultMap</span>=<span class="string">"MyResult"</span>&gt;</span></span><br><span class="line">      select e.id id,e.name name ,e.address address,d.id did,d.dept_name dept_name from tb_user e,tbl_dept d</span><br><span class="line">      where e.d_id=d.id and e.id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方法2：association标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--联合查询：级联属性封装结果--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyResult"</span> <span class="attr">type</span>=<span class="string">"com.zero.dao.Blog"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--可以指定联合的javaBean对象</span></span><br><span class="line"><span class="comment">        property="dept" 指定那个属性是联合对象</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"dept"</span>  <span class="attr">javaType</span>=<span class="string">"com.zero.dao.Department"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"did"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    String resource = <span class="string">"mybatis/mybatis-config.xml"</span>;</span><br><span class="line">    InputStream is = Resources.getResourceAsStream(resource);</span><br><span class="line">    SqlSessionFactory sessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line">    SqlSession session = sessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        BlogMapperPlus mapper = session.getMapper(BlogMapperPlus.class);</span><br><span class="line">        Blog blog = mapper.getBlogAndDeptById(<span class="number">5</span>);</span><br><span class="line">        System.out.println(blog);</span><br><span class="line">        System.out.println(blog.getDept());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意事项：这里测试的时候有报错信息：No constructor found in</p>
<p>Bean里面有一个全参数的构造函数，但是字段类型不匹配。</p>
<p>此时需要检查两个相互关联的javaBean是否有构造方法，如果设置了有参的构造方法，那么还需要有默认的无参构造。两个javaBean都需要。</p>
<p>方法三：association分布查询</p>
<p>先查询user然后拿到d_id之后再去部门里查询部门信息，这就可以写两个sql。一个比较复杂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">BlogMapperPlus.xml</span><br><span class="line">    <span class="comment">&lt;!--使用association进行分步查询</span></span><br><span class="line"><span class="comment">        1、先按照员工id查询员工信息</span></span><br><span class="line"><span class="comment">        2、根据查询员工信息中的d_id值去部门表查出部门信息</span></span><br><span class="line"><span class="comment">        3、部门设置员工中</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyResult1"</span> <span class="attr">type</span>=<span class="string">"com.zero.bean.Blog"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        association定义关联的对象的封装规则.dept的值是调用查询方法查出来的.</span></span><br><span class="line"><span class="comment">        select:表明当前的属性是调动select指定的方法查出的结果</span></span><br><span class="line"><span class="comment">        column:指定将哪一列的值传递给这个方法</span></span><br><span class="line"><span class="comment">        流程：使用select指定的方法(传入column指定的这列参数的值)查出对象，并封装给property指定的属性</span></span><br><span class="line"><span class="comment">        --&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"dept"</span> <span class="attr">select</span>=<span class="string">"com.zero.dao.DepartmentMapper.getDeptById"</span> <span class="attr">column</span>=<span class="string">"d_id"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBlogByIdStep"</span> <span class="attr">resultMap</span>=<span class="string">"MyResult1"</span>&gt;</span></span><br><span class="line">        select * from tb_user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BlogMapperPlus mapper = session.getMapper(BlogMapperPlus.class);</span><br><span class="line">Blog dept = mapper.getBlogByIdStep(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<h5 id="分布查询-amp-延迟加载"><a href="#分布查询-amp-延迟加载" class="headerlink" title="分布查询&amp;延迟加载"></a>分布查询&amp;延迟加载</h5><p>每次查询user的时候，都将一起查询出来。部门信息在我们使用的时候再去查询；</p>
<p>需要在分段查询的基础上再加两个配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启延迟加载 显示的指定每个我们需要更改的配置的值，即使他是默认的，防止更新带来的问题--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--在需要任何属性的时候，属性都会被加载，否则属性会在被需要的时候加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BlogMapperPlus mapper = session.getMapper(BlogMapperPlus.class);</span><br><span class="line">Blog dept = mapper.getBlogByIdStep(<span class="number">5</span>);</span><br><span class="line">System.out.println(dept.getName());</span><br></pre></td></tr></table></figure>
<h5 id="collection定义关联集合封装规则"><a href="#collection定义关联集合封装规则" class="headerlink" title="collection定义关联集合封装规则"></a>collection定义关联集合封装规则</h5><p>场景二：查询部门的时候将部门对应的所有员工信息也查询出来。</p>
<p><collection>定义关联集合类型的属性的封装规则</collection></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--嵌套结果集方式，使用collection标签定义关联的集合类型的属性封装规则--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyDept"</span> <span class="attr">type</span>=<span class="string">"com.zero.bean.Department"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--collection定义关联集合类型的属性的封装规则</span></span><br><span class="line"><span class="comment">        这里指定blogs是一个集合</span></span><br><span class="line"><span class="comment">        ofType:指定集合里面元素的类型</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"blogs"</span> <span class="attr">ofType</span>=<span class="string">"com.zero.bean.Blog"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义集合中元素的封装规则--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"eid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--getDeptByIdPlus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDeptByIdPlus"</span> <span class="attr">resultMap</span>=<span class="string">"MyDept"</span>&gt;</span></span><br><span class="line">    select d.id did,d.dept_name dept_name,e.id eid,e.name name,e.address address</span><br><span class="line">    from tbl_dept d</span><br><span class="line">    left join tb_user e</span><br><span class="line">    on d.id=e.d_id</span><br><span class="line">    where d.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时查询结果时出现两个问题：</p>
<ul>
<li>不显示department的id，id为null</li>
<li>该部门有多个员工时提示报错。</li>
</ul>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/%E6%A1%86%E6%9E%B6/Mybatis/found%EF%BC%9A2.png?raw=true" alt=""></p>
<p>上面两个问题都是由于一个原因：</p>
<p>在DepartmentMapper.xml中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.id did   查询出来的是以did命名的</span><br></pre></td></tr></table></figure>
<p>而resultMap</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>column依然是id，这里改为did即可。</p>
<h5 id="collection分布查询-amp-延迟加载"><a href="#collection分布查询-amp-延迟加载" class="headerlink" title="collection分布查询&amp;延迟加载"></a>collection分布查询&amp;延迟加载</h5><p>分不查询可以先查dept中id为1的对象</p>
<p>然后再查employee中did也为1的对象</p>
<p>操作如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpsByDeptId</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByDeptId"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.bean.Employee"</span> &gt;</span></span><br><span class="line">    select * from tb_user where d_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>DepartmentMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Department <span class="title">getDeptByIdStep</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyDeptStep"</span> <span class="attr">type</span>=<span class="string">"com.zero.bean.Department"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"employees"</span> <span class="attr">select</span>=<span class="string">"com.zero.dao.EmployeeMapperPlus.getEmpsByDeptId"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--getDeptByIdStep--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDeptByIdStep"</span> <span class="attr">resultMap</span>=<span class="string">"MyDeptStep"</span>&gt;</span></span><br><span class="line">    select id,dept_name dept_name from tbl_dept where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>column是指定要把那一列的值传给这个方法</p>
<p>如果要将多列的值传入要怎么操作呢？</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyDeptStep"</span> <span class="attr">type</span>=<span class="string">"com.zero.bean.Department"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"dept_name"</span> <span class="attr">property</span>=<span class="string">"departmentName"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"employees"</span> <span class="attr">select</span>=<span class="string">"com.zero.dao.EmployeeMapperPlus.getEmpsByDeptId"</span> <span class="attr">column</span>=<span class="string">"&#123;deptId=id&#125;"</span>  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--getDeptByIdStep--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDeptByIdStep"</span> <span class="attr">resultMap</span>=<span class="string">"MyDeptStep"</span>&gt;</span></span><br><span class="line">    select id,dept_name dept_name from tbl_dept where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--扩展 collection要传递多列的值</span></span><br><span class="line"><span class="comment">    column="&#123;key1=column1,key2=column2&#125;"</span></span><br><span class="line"><span class="comment">    fetchType="lazy"  ：表示使用延迟加载</span></span><br><span class="line"><span class="comment">    lazy：延迟</span></span><br><span class="line"><span class="comment">    eager：立即</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="discriminator标签鉴别器"><a href="#discriminator标签鉴别器" class="headerlink" title="discriminator标签鉴别器"></a>discriminator标签鉴别器</h5><p>mybatis可以通过鉴别器识别某个列的值并作出相应的操作。</p>
<p>例如：如果是女生就把该女生的部门信息查询出来</p>
<p>​       如果是男生就不查询部门信息，但是要把name赋值给email</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"MyEmpDis"</span> <span class="attr">type</span>=<span class="string">"com.zero.bean.Employee"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis可以使用鉴别器判某列的值，然后根据某列的值改变封装行为</span></span><br><span class="line"><span class="comment">        封装Employee:</span></span><br><span class="line"><span class="comment">            如果查出的是女生 0 就把部门信息查询出来，否则不查。</span></span><br><span class="line"><span class="comment">            如果是男生 1，把name这一列的值赋值给email</span></span><br><span class="line"><span class="comment">        column:指定要判定的列名</span></span><br><span class="line"><span class="comment">        javaType:列值对应的java类型</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">"string"</span> <span class="attr">column</span>=<span class="string">"gender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--女生 resultType:列值对应的java类型.也可以是resultMap但是不能缺少--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.bean.Employee"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"dept"</span> <span class="attr">select</span>=<span class="string">"com.zero.dao.DepartmentMapper.getDeptById"</span> <span class="attr">column</span>=<span class="string">"d_id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--男生把name赋值给email--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.bean.Employee"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="DynamicSQL"><a href="#DynamicSQL" class="headerlink" title="DynamicSQL"></a>DynamicSQL</h3><ul>
<li>动态SQL是Mybatis强大特性之一。极大的简化我们拼装SQL的操作。</li>
<li>动态SQL元素和使用JSTL或其他类似基于XML的文本处理器相似。</li>
<li>MyBatis采用功能强大的基于OGNL的表达式来简化操作。<ul>
<li>if</li>
<li>choose(when , otherwise)</li>
<li>trim(where,set)</li>
<li>foreach</li>
</ul>
</li>
</ul>
<h4 id="if判断"><a href="#if判断" class="headerlink" title="if判断"></a>if判断</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查询员工，emp对象携带了那个字段就通过这个字段来查询或者叠加查询--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByconditionIf"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.bean.Employee"</span>&gt;</span></span><br><span class="line">       select * from tb_user</span><br><span class="line">       where</span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">           id=#&#123;id&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- test:判断表达式（OGNL）  c:if test</span></span><br><span class="line"><span class="comment">            从参数中取值进行判断</span></span><br><span class="line"><span class="comment">            遇见特殊符号应该去写转义字符比如</span></span><br><span class="line"><span class="comment">             " :&amp;quot;   或者 ''</span></span><br><span class="line"><span class="comment">             &amp;&amp; ： &amp;amp;&amp;amp;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name !=null and name !=''"</span>&gt;</span></span><br><span class="line">           and name like #&#123;name&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;if test="address !=null and address !='' "&gt;--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address !=null &amp;amp;&amp;amp; address !=&amp;quot;&amp;quot; "</span>&gt;</span></span><br><span class="line">           and address =#&#123;address&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email !=null and email.trim()!=&amp;quot;&amp;quot;"</span>&gt;</span></span><br><span class="line">           and email=#&#123;email&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--ognl会进行字符串与数字的转换判断 "0"==0  字符串0和数字0是一样的 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender==0 or gender==1"</span>&gt;</span></span><br><span class="line">           and gender=#&#123;gender&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里传入的参数是Employee，OGNL会自动识别里面的值</p>
<h4 id="where查询条件"><a href="#where查询条件" class="headerlink" title="where查询条件"></a>where查询条件</h4><p>上面的如果没有id，那么sql语句就会直接变成select * from tb_user  where and address = ?</p>
<p>明显sql语句是错误的。</p>
<p>如果查询的时候如果某些条件没带sql拼装就会有问题</p>
<p>解决方法：</p>
<ol>
<li><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where  1==1</span><br></pre></td></tr></table></figure>
</li>
<li><p>mybatis使用where标签来将所有的查询条件包括在内</p>
</li>
</ol>
<p>将所有if放到<where></where>标签内即可。这样，mybatis会将where标签中多出来的and或者or去掉。但是有时候where也是不好使的。例如：</p>
<p>将and放在语句的后面。  email=#{email}</p>
<p>where就只会去掉第一个多出来的and或者or</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tb_user <span class="keyword">WHERE</span> address =? <span class="keyword">and</span></span><br></pre></td></tr></table></figure>
<p><strong>所以在使用where标签的时候，and要写在第一位</strong></p>
<h4 id="sql-trim自定义字符串截取"><a href="#sql-trim自定义字符串截取" class="headerlink" title="sql_trim自定义字符串截取"></a>sql_trim自定义字符串截取</h4><p>就像上面的where标签所描述的那样，如果把and或者or放在了sql的后面，那么只能识别第一个and或者or其他的就会报错。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">""</span> <span class="attr">prefixOverrides</span>=<span class="string">""</span> <span class="attr">suffix</span>=<span class="string">""</span> <span class="attr">suffixOverrides</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>trim有四个属性</p>
<ul>
<li>prefix：给拼串后的整个字符串加一个前缀</li>
<li>prefixOverrides:前缀覆盖：去掉整个字符串前面多余的字符</li>
<li>suffix：给拼串后的整个字符串加一个后缀</li>
<li>suffixOverrides：去掉整个字符串后面多余的字符</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByonditionTrim"</span>  <span class="attr">resultType</span>=<span class="string">"com.zero.bean.Employee"</span>&gt;</span></span><br><span class="line">        select * from tb_user</span><br><span class="line">        <span class="comment">&lt;!-- 自定义截取规则 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"where"</span> <span class="attr">suffixOverrides</span>=<span class="string">"and"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">        id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- test:判断表达式（OGNL）  c:if test</span></span><br><span class="line"><span class="comment">         从参数中取值进行判断</span></span><br><span class="line"><span class="comment">         遇见特殊符号应该去写转义字符比如</span></span><br><span class="line"><span class="comment">          " :&amp;quot;   或者 ''</span></span><br><span class="line"><span class="comment">          &amp;&amp; ： &amp;amp;&amp;amp;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name !=null and name !=''"</span>&gt;</span></span><br><span class="line">         name like #&#123;name&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;if test="address !=null and address !='' "&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address !=null &amp;amp;&amp;amp; address !=&amp;quot;&amp;quot; "</span>&gt;</span></span><br><span class="line">         address =#&#123;address&#125;  and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email !=null and email.trim()!=&amp;quot;&amp;quot;"</span>&gt;</span></span><br><span class="line">         email=#&#123;email&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ognl会进行字符串与数字的转换判断 "0"==0  字符串0和数字0是一样的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender==0 or gender==1"</span>&gt;</span></span><br><span class="line">         gender=#&#123;gender&#125; and</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样就会自动在最前面添加一个where，然后在最后面去除一个and</p>
<h4 id="sql-choose分支选择"><a href="#sql-choose分支选择" class="headerlink" title="sql_choose分支选择"></a>sql_choose分支选择</h4><p>类似于java里的 switch   case</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">&lt;!--choose：分支选择</span></span><br><span class="line"><span class="comment">        如果带了id就用id查，如果带了name就用name查，只会进入其中一个</span></span><br><span class="line"><span class="comment">        choose标签里的when标签里的test就是判断条件</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpsByonditionChoose"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.bean.Employee"</span>&gt;</span></span><br><span class="line">      select * from tb_user</span><br><span class="line">      <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"id!=null"</span>&gt;</span></span><br><span class="line">                  id=#&#123;id&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"name!=null"</span>&gt;</span></span><br><span class="line">                  name like #&#123;name&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"email!=null"</span>&gt;</span></span><br><span class="line">                  email = #&#123;email&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                  gender = 0</span><br><span class="line">              <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果传入了多个判断条件，那么它只会查符合第一个条件的</p>
<h4 id="sql-set"><a href="#sql-set" class="headerlink" title="sql_set"></a>sql_set</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 带了那一列的值就更新那一列 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateEmp"</span>&gt;</span></span><br><span class="line">    update  tb_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"set"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name!=null"</span>&gt;</span></span><br><span class="line">        name=#&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email!=null"</span>&gt;</span></span><br><span class="line">        email=#&#123;email&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="sql-foreach遍历集合"><a href="#sql-foreach遍历集合" class="headerlink" title="sql_foreach遍历集合"></a>sql_foreach遍历集合</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getEmpByConditionForeach"</span> <span class="attr">resultType</span>=<span class="string">"com.zero.bean.Employee"</span>&gt;</span></span><br><span class="line">    select * from tb_user where id in</span><br><span class="line">    <span class="comment">&lt;!-- collection:指定要遍历的集合：</span></span><br><span class="line"><span class="comment">         list类型的参数会特殊处理封装map中，map的key就叫list</span></span><br><span class="line"><span class="comment">         item：将当前遍历出的元素赋值给指定的定位</span></span><br><span class="line"><span class="comment">         separator:每个元素之间的分隔符</span></span><br><span class="line"><span class="comment">         open:遍历所有结果拼接一个开始的字符</span></span><br><span class="line"><span class="comment">         close:遍历出所有结果拼接一个结束的字符</span></span><br><span class="line"><span class="comment">         index:索引。遍历list的时候是索引，item就是当前值</span></span><br><span class="line"><span class="comment">                    遍历map的时候index表示的就是map的key，item就是map的值</span></span><br><span class="line"><span class="comment">         #&#123;变量名&#125;就能取出变量的值也就是当前遍历出的元素</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item_id"</span> <span class="attr">separator</span>=<span class="string">","</span>  <span class="attr">open</span> =<span class="string">"("</span> <span class="attr">close</span> =<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;item_id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmpByConditionForeach</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EmployeeMapperDynamicSQL mapper = session.getMapper(EmployeeMapperDynamicSQL.class);</span><br><span class="line">List&lt;Employee&gt; foreach = mapper.getEmpByConditionForeach(Arrays.asList(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>));</span><br><span class="line"><span class="keyword">for</span> (Employee e:foreach)&#123;</span><br><span class="line">    System.out.println(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="批量保存"><a href="#批量保存" class="headerlink" title="批量保存"></a>批量保存</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmps"</span> &gt;</span></span><br><span class="line">    insert into tb_user(name,address,email,gender,d_id)</span><br><span class="line">    values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"emp"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        (#&#123;emp.name&#125;,#&#123;emp.address&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EmployeeMapperDynamicSQL mapper = session.getMapper(EmployeeMapperDynamicSQL.class);</span><br><span class="line">List&lt;Employee&gt; emps = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">emps.add(<span class="keyword">new</span> Employee(<span class="keyword">null</span>,<span class="string">"smith"</span>,<span class="string">"beijing"</span>,<span class="string">"whyathere@163.com"</span>,<span class="string">"1"</span>,<span class="keyword">new</span> Department(<span class="number">1</span>)));</span><br><span class="line">emps.add(<span class="keyword">new</span> Employee(<span class="keyword">null</span>,<span class="string">"smith"</span>,<span class="string">"beijing"</span>,<span class="string">"whyathere@163.com"</span>,<span class="string">"1"</span>,<span class="keyword">new</span> Department(<span class="number">2</span>)));</span><br><span class="line">mapper.addEmps(emps);</span><br><span class="line">session.commit();</span><br></pre></td></tr></table></figure>
<p><strong>另外一种方式</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addEmps"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"emp"</span> <span class="attr">separator</span>=<span class="string">";"</span>&gt;</span></span><br><span class="line">        insert into tb_user(name,address,gender,email,d_id)</span><br><span class="line">        values (#&#123;emp.name&#125;,#&#123;emp.address&#125;,#&#123;emp.gender&#125;,#&#123;emp.email&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是这个时候会报错。sql不支持。需要进行配置</p>
<p>allowMultiQueries：在一条语句中，运行使用”;”来分隔多条查询(真/假，默认值为”假”)</p>
<h4 id="内置参数-parameter-amp-databaseld"><a href="#内置参数-parameter-amp-databaseld" class="headerlink" title="内置参数_parameter&amp;_databaseld"></a>内置参数_parameter&amp;_databaseld</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--两个内置参数</span></span><br><span class="line"><span class="comment">    不只是方法传递过来的参数可以被用来判断，取值</span></span><br><span class="line"><span class="comment">    mybatis默认还有两个内置参数：</span></span><br><span class="line"><span class="comment">    _parameter:代表整个参数</span></span><br><span class="line"><span class="comment">    如果是单个参数:_parameter就是这个参数；</span></span><br><span class="line"><span class="comment">         多个参数:就会被封装为一个map，_parameter就代表这个map；</span></span><br><span class="line"><span class="comment">    _databaseId:</span></span><br><span class="line"><span class="comment">         如果配置了databaseIdProvider标签</span></span><br><span class="line"><span class="comment">         _databaseId就是代表当前数据库的别名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/Java%E5%9F%BA%E7%A1%80/databaseProvider.png?raw=true" alt=""></p>
<p><img src="https://github.com/whyathere/tuchuang/blob/master/Java%E5%9F%BA%E7%A1%80/select.png?raw=true" alt=""></p>
<h4 id="sql-bing绑定"><a href="#sql-bing绑定" class="headerlink" title="sql_bing绑定"></a>sql_bing绑定</h4><p>bing：可以将ognl表达式的值绑定到一个变量中，方便后面引用这个变量的值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bind: 可以将OGNL表达式的值绑定到一个变量中，方便后面来引用这个变量的值</span></span><br><span class="line"><span class="comment">     value:就是要绑定值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"_name"</span> <span class="attr">value</span>=<span class="string">"'%'+name+'%'"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的是将name拼串模糊查询的样例，然后赋值给_name</p>
<h4 id="抽取可重用sql片段"><a href="#抽取可重用sql片段" class="headerlink" title="抽取可重用sql片段 "></a>抽取可重用sql片段 <sql></sql></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"insertColum"</span>&gt;</span></span><br><span class="line">  user_id,name,email</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"insertColum"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testColomn"</span> <span class="attr">value</span>=<span class="string">"adc"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">设置了property就可以用$&#123;testColomn&#125;取值</span><br></pre></td></tr></table></figure>
<p>作用：</p>
<ol>
<li><p>sql抽取：将常要查询的列名，或者插入用的列名抽取出来方便使用</p>
</li>
<li><p>include还可以自定义一些property，sql标签内部就能使用自定义的属性</p>
<p>include标签的property设置的值，需要用${取值}而不能用#{}</p>
</li>
</ol>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>Mybatis包含一个非常强大的查询缓存特性，它可以非常方便地配置和定制。缓存可以极大的提升查询效率。</p>
<ol>
<li>Mybatis系统中默认定义了两级缓存。</li>
<li><p>一级缓存<strong>和 </strong>二级缓存**</p>
</li>
<li><p>默认情况下，只有一级缓存(SqlSession级别的缓存，也称为本地缓存)开启。</p>
</li>
<li><p>二级缓存需要手动开启和配置，他是基于namespace级别的缓存</p>
</li>
<li><p>为了提高扩展性。Mybatis定义了缓存接口Cache。我们可以通过实现Cache接口来自定义二级缓存</p>
</li>
</ol>
<h4 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h4><p>一级缓存：本地缓存</p>
<p>与数据库同一次会话期间查询到的数据会放在本地缓存中。以后如果要获取相同的数据，直接从缓存中拿，没必要再去查询数据库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EmployeeMapperPlus mapper = session.getMapper(EmployeeMapperPlus.class);</span><br><span class="line">Employee emp1 = mapper.getEmployeeById(<span class="number">5</span>);</span><br><span class="line">Employee emp2 = mapper.getEmployeeById(<span class="number">5</span>);</span><br><span class="line">System.out.println(emp1);</span><br><span class="line">System.out.println(emp2);</span><br></pre></td></tr></table></figure>
<p>二级缓存：全局缓存</p>
<p>例如：按照id来查询同一个id两次，那么两次拿到的东西其实是一样的。包括对象。是从一级缓存中拿的。</p>
<h5 id="一级缓存失效的四种情况"><a href="#一级缓存失效的四种情况" class="headerlink" title="一级缓存失效的四种情况"></a>一级缓存失效的四种情况</h5><p>一级缓存是一直开启的，个人是无法关闭的。</p>
<p>一级缓存是sqlSession级别的缓存。</p>
<p>一级缓存失效情况：一级缓存没有使用，效果是还需要再向数据库发送查询</p>
<ol>
<li><p>sqlsession不同</p>
</li>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">EmployeeMapperPlus mapper = session.getMapper(EmployeeMapperPlus.class);</span><br><span class="line">Employee emp1 = mapper.getEmployeeById(<span class="number">5</span>);</span><br><span class="line">System.out.println(emp1);</span><br><span class="line"></span><br><span class="line">SqlSession session1 = sessionFactory.openSession();</span><br><span class="line">EmployeeMapperPlus mapper1 = session1.getMapper(EmployeeMapperPlus.class);</span><br><span class="line">Employee employeeById = mapper1.getEmployeeById(<span class="number">5</span>);</span><br><span class="line">System.out.println(employeeById);</span><br></pre></td></tr></table></figure>
<p>两次结果就不同了。而且发送了两次sql查询语句。</p>
</li>
<li><p>sqlSession相同，但是查询条件不同，当前这个session还没有这个数据</p>
</li>
<li><p>sqlSession相同，两次查询之间执行了增删改操作。添加了信息就会重新发送</p>
</li>
<li><p>sqlSession相同，但是手动清除了一级缓存。</p>
</li>
</ol>
<p>openSession.clearCache();    //清除缓存</p>
<h4 id="二级缓存介绍"><a href="#二级缓存介绍" class="headerlink" title="二级缓存介绍"></a>二级缓存介绍</h4><p>二级缓存是基于namespace级别的缓存：一个名称空间对应一个二级缓存</p>
<p>二级缓存工作机制：</p>
<ol>
<li>一个会话查询一条数据：这个数据就会被放在当前会话的一级缓存中；</li>
<li>如果当前会话关闭了，这个会话对应的一级缓存也就没有了。但是mybatis并没有清空，如果会话关闭，一级缓存中的数据会被保存到二级缓存中。新的会话查询信息，就可以参照二级缓存</li>
<li>sqlSession既有employeemapper查的employee又有DepartmentMapper查的Department对象。会被放在两个不同的namespace中，会放在自己的map中。</li>
</ol>
<h4 id="二级缓存的使用"><a href="#二级缓存的使用" class="headerlink" title="二级缓存的使用"></a>二级缓存的使用</h4><p>使用：开启全局二级缓存配置</p>
<ol>
<li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--显式的指定每个我们需要更改的配置的值，即使他是默认的。防止版本更新带来的问题--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>2.</p>
<p>由于二级缓存是基于mapper级别的，一个namespace对应一个二级缓存</p>
<p>需要去mapper.xml中配置二级缓存。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zero.dao.EmployeeMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样即开启了。</p>
<p>但是也有一些默认的策略。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">""</span> <span class="attr">flushInterval</span>=<span class="string">""</span> <span class="attr">readOnly</span>=<span class="string">""</span> <span class="attr">size</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>eviction</strong>：缓存的回收策略:</p>
<ul>
<li><p>LRU - 最近最少使用的；移除最长时间不被使用的对象。</p>
</li>
<li><p>FIFO - 先进先出；按照对象进入缓存的顺序来移除它们</p>
</li>
<li>SOFT - 软引用;移除基于垃圾回收器状态和软引用规则的对象</li>
<li>WEAK - 弱引用；更积极地移除基于垃圾收集器状态和弱引用规则的对象</li>
<li>默认的是LRU。</li>
</ul>
<p><strong>flushInterval</strong> : 缓存刷新间隔</p>
<p>缓存多长时间清空一次，默认是不清空，设置一个毫秒值</p>
<p><strong>readOnly</strong>：缓存是否只读。</p>
<p>true:只读。mybatis认为所有从缓存中获取数据的操作都是只读操作，不会修改操作</p>
<p>​        mybatis为了加快获取速度，直接就会将数据在缓存中的引用交给用户。不安全，但是速度快</p>
<p>false：非只读；mybatis觉的获取来的数据可能会被修改。</p>
<p>​            mybatis会利用序列化&amp;反序列化技术克隆一份新的数据给你。安全，速度稍慢一点。</p>
<p>默认是false</p>
<p><strong>size</strong>：缓存存放多少元素</p>
<p><strong>type</strong>:””,指定自定义缓存的全类名；</p>
<p>​        实现Cache接口即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">"FOFO"</span> <span class="attr">flushInterval</span>=<span class="string">"60000"</span> <span class="attr">readOnly</span>=<span class="string">"false"</span> <span class="attr">size</span>=<span class="string">"1024"</span> <span class="attr">type</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>我们的POJO需要实现序列号接口，因为需要序列化和序列化</li>
</ol>
<p>首先在未开启二级缓存的时候进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    String resource = <span class="string">"mybatis/mybatis-config.xml"</span>;</span><br><span class="line">    InputStream is = Resources.getResourceAsStream(resource);</span><br><span class="line">    SqlSessionFactory sessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line">    SqlSession session1 = sessionFactory.openSession();</span><br><span class="line">    SqlSession session2 = sessionFactory.openSession();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper1 = session1.getMapper(EmployeeMapper.class);</span><br><span class="line">        EmployeeMapper mapper2 = session2.getMapper(EmployeeMapper.class);</span><br><span class="line">        Employee employee = mapper1.getEmployee(<span class="number">5</span>);</span><br><span class="line">        System.out.println(employee);</span><br><span class="line">        session1.close();</span><br><span class="line">        Employee employee1 = mapper2.getEmployee(<span class="number">5</span>);</span><br><span class="line">        System.out.println(employee1);</span><br><span class="line">        session2.close();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        session1.close();</span><br><span class="line">        session2.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时会进行两次sql查询。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">"FIFO"</span> <span class="attr">flushInterval</span>=<span class="string">"60000"</span> <span class="attr">readOnly</span>=<span class="string">"false"</span> <span class="attr">size</span>=<span class="string">"1024"</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>开启缓存</p>
<p>就只会查询一次了，这里要注意一定要实现Employee类的序列化。</p>
<p>这次查询 是从二级缓存中获取，而不是再去查询。</p>
<p>虽然关闭了一级缓存，但是放到了二级缓存中。</p>
<p>只有会话提交或者关闭，一级缓存中的数据才会转移到二级缓存中。</p>
<h4 id="缓存有关的设置以及属性"><a href="#缓存有关的设置以及属性" class="headerlink" title="缓存有关的设置以及属性"></a>缓存有关的设置以及属性</h4><ol>
<li><p>开启缓存，false的时候是关闭缓存。关闭的是二级缓存，一级缓存一直可用</p>
</li>
<li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>为什么可以用缓存。</p>
<p>在每一个查询<select>标签都会有一个属性，userCache使用缓存，默认为true</select></p>
<p>一级二级都可以使用，当关闭的时候禁用的时候一级缓存依然可以使用。</p>
<p>useCache对一级缓存是没有影响的，影响的是二级缓存。</p>
</li>
<li><p>每个增删改标签都有一个属性 flushCache = “true”；增删改执行完成后就会清除缓存。清除一级缓存和二级缓存。都会清除。虽然会从二级缓存查询，但是二级缓存已经被清除了。查询是不清除缓存的，如果查询标签设置flushCache = “true”也会禁用掉一级二级缓存。</p>
</li>
<li><p>sqlSession.clearCache();  只是清除Session的一级缓存跟二级缓存没有关系</p>
<h4 id="缓存的原理总结"><a href="#缓存的原理总结" class="headerlink" title="缓存的原理总结"></a>缓存的原理总结</h4><p>一级缓存会话关闭才会保存在二级缓存中。</p>
<p>关闭以后，新的会话进来，已经存在二级缓存的话就会先查找二级缓存中是否有对应的数据。</p>
<p>一进来就先看二级缓存，因为它的范围更大，如果没有才会去查找一级缓存。最好才会去查找数据库。</p>
</li>
</ol>
<h3 id="整合ehcache"><a href="#整合ehcache" class="headerlink" title="整合ehcache"></a>整合ehcache</h3><p>1、首先导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在mapper中添加一个标签就可以了</p>
<cache type="org.mybatis.caches.encache.EncacheCache">

<p>ehcache运行的时候需要一个ehcache.xml文件</p>
</cache>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Mybatis/" rel="tag"># Mybatis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/10/异常/" rel="next" title="异常">
                <i class="fa fa-chevron-left"></i> 异常
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/10/复制hexo/" rel="prev" title="复制hexo">
                复制hexo <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">50</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#全局参数配置"><span class="nav-number">1.</span> <span class="nav-text">全局参数配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#批量起别名"><span class="nav-number">1.1.</span> <span class="nav-text">批量起别名</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mybatis参数"><span class="nav-number">2.</span> <span class="nav-text">Mybatis参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#主要参数的意义"><span class="nav-number">2.1.</span> <span class="nav-text">主要参数的意义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Param"><span class="nav-number">2.2.</span> <span class="nav-text">@Param</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#以Map为参数集合"><span class="nav-number">2.3.</span> <span class="nav-text">以Map为参数集合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编写专门的TO"><span class="nav-number">2.4.</span> <span class="nav-text">编写专门的TO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#传参处理"><span class="nav-number">2.5.</span> <span class="nav-text">传参处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#和-取值"><span class="nav-number">3.</span> <span class="nav-text">#和$取值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询"><span class="nav-number">4.</span> <span class="nav-text">查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#select记录封装map"><span class="nav-number">4.1.</span> <span class="nav-text">select记录封装map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义结果映射规则-resultMap"><span class="nav-number">4.2.</span> <span class="nav-text">自定义结果映射规则 resultMap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resultMap关联查询"><span class="nav-number">4.3.</span> <span class="nav-text">resultMap关联查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#分布查询-amp-延迟加载"><span class="nav-number">4.3.1.</span> <span class="nav-text">分布查询&amp;延迟加载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#collection定义关联集合封装规则"><span class="nav-number">4.3.2.</span> <span class="nav-text">collection定义关联集合封装规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#collection分布查询-amp-延迟加载"><span class="nav-number">4.3.3.</span> <span class="nav-text">collection分布查询&amp;延迟加载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#discriminator标签鉴别器"><span class="nav-number">4.3.4.</span> <span class="nav-text">discriminator标签鉴别器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DynamicSQL"><span class="nav-number">5.</span> <span class="nav-text">DynamicSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#if判断"><span class="nav-number">5.1.</span> <span class="nav-text">if判断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#where查询条件"><span class="nav-number">5.2.</span> <span class="nav-text">where查询条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql-trim自定义字符串截取"><span class="nav-number">5.3.</span> <span class="nav-text">sql_trim自定义字符串截取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql-choose分支选择"><span class="nav-number">5.4.</span> <span class="nav-text">sql_choose分支选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql-set"><span class="nav-number">5.5.</span> <span class="nav-text">sql_set</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql-foreach遍历集合"><span class="nav-number">5.6.</span> <span class="nav-text">sql_foreach遍历集合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#批量保存"><span class="nav-number">5.6.1.</span> <span class="nav-text">批量保存</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内置参数-parameter-amp-databaseld"><span class="nav-number">5.7.</span> <span class="nav-text">内置参数_parameter&amp;_databaseld</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql-bing绑定"><span class="nav-number">5.8.</span> <span class="nav-text">sql_bing绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抽取可重用sql片段"><span class="nav-number">5.9.</span> <span class="nav-text">抽取可重用sql片段 </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存"><span class="nav-number">6.</span> <span class="nav-text">缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一级缓存"><span class="nav-number">6.1.</span> <span class="nav-text">一级缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一级缓存失效的四种情况"><span class="nav-number">6.1.1.</span> <span class="nav-text">一级缓存失效的四种情况</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二级缓存介绍"><span class="nav-number">6.2.</span> <span class="nav-text">二级缓存介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二级缓存的使用"><span class="nav-number">6.3.</span> <span class="nav-text">二级缓存的使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#缓存有关的设置以及属性"><span class="nav-number">6.4.</span> <span class="nav-text">缓存有关的设置以及属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#缓存的原理总结"><span class="nav-number">6.5.</span> <span class="nav-text">缓存的原理总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整合ehcache"><span class="nav-number">7.</span> <span class="nav-text">整合ehcache</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
