Spring

###	简介

耦合具有两面性。一方面，紧密耦合的代码难以测试，难以复用、难以理解，并且典型地表现出“打地鼠”式的bug特性。另一方面，一定程度的耦合又是必须的—完全没有耦合的代码什么都做不了。为了完成有意义的功能，不同的类必须适当的进行交互。总而言之，耦合是必须的，但应当被小心谨慎地管理。

创建应用组件之间协作的行为通常称为装配（wiring）。Spring有多种装配bean的方式，采用xml是很常见的一种装配行为。

#### 观察它如何工作

Spring通过应用上下文(Application Context)装载bean的定义并把它们组装起来。Spring应用上下文全权负责对象的创建和组装。Spring自带了多种应用上下文的实现，它们之间主要的区别仅仅在于如何配置。

ClassPathXmlApplicationContext	该类加载位于应用程序类路径下的一个或多个XML配置文件。

#### 容纳你的Bean

在基于Spring的应用中，你的应用对象生存于Spring容器(container)中。Spring容器负责创建对象，装配它们，配置它们并管理它们的整个生命周期，从生存到死亡(在这里，可能就是new 到 finalize())。

首先了解容纳对象的容器，有助于理解对象是如何被管理的。

容器上Spring容器的核心。Spring容器使用DI管理构成应用的组建，它会创建相互协作的组件之间的关联。

Spring容器并不是只有一个。Spring自带了多个容器实现，可以归为两种不同的类型。bean工厂上最简单的容器，提供基本的DI支持。应用上下文基于BeanFactory构建，并提供应用框架级别的服务，例如从属性文件解析文本信息以及发布应用事件给感兴趣的事件监听者。

虽然我们可以在bean工厂和应用上下文之间任选一种。但bean工厂对大多数应用来说太低级了，因此，应用上下文要比bean工厂更受欢迎。我们把精力集中在应用上下文上，不再浪费时间讨论bean工厂。

##### 使用应用上下文

常用的几个应用上下文

AnnotationConfigApplicationContext：从一个或多个基于Java的配置类中加载Spring应用上下文。

ClassPathXmlApplicationContext：从类路径下的一个或多个XML配置文件中加载上下文定义，把应用上下文的定义文件作为类资源。

FileSystemXmlApplicationContext：从文件系统下的一个或多个XML配置文件中加载上下文定义。



DI是组装应用对象的一种方式，借助这种方式对象无需知道依赖来自何处或者依赖的实现方式。不同于自己获取依赖对象，对象会在运行期赋予它们所依赖的对象。依赖对象通常会通过接口了解所注入的对象，这样的话就能确保低耦合。



### 装配Bean

#### Spring 配置的可选方案

Spring容器负责创建应用程序中的bean并通过DI来协调这些对象之间的关系。但是，作为开发人员，你需要告诉Spring要创建哪些bean并且如何将其装配在一起。

当描述bean如何进行装配时，Spring具有非常大的灵活性，它提供了三种主要的装配机制：

- 在XML中进行显式配置
- 在Java中进行显示配置
- 隐式的bean发现机制和自动装配

#### 自动装配bean

Spring从两个角度来实现自动化装配：

- 组件扫描(component scanning)：Spring 会自动发现应用上下文中所创建的bean。
- 自动装配(autowiring)：Spring 自动满足bean之间的依赖。

组件扫描和自动装配组合在一起就能发挥出强大的威力，它们能够将你的显示配置降低到最少。

##### 创建可被发现的bean

CD为我们阐述DI如何运行提供了一个很好的样例。如果你不将CD插入(注入)到CD播放器中，那么CD播放器其实是没有太大的用处的。所以，可以这样说，CD播放器依赖于CD才能完成它的使命。

使用

@Component 注解：这个简单的注解表明该类会作为组件类，并告知Spring要为这个类创建bean。

不过组件扫描默认是不开启的。需要显示配置一下Spring，从而命令它去寻找带有@Component注解的类，并为其创建bean。

@Configuration

@ComponentScan：这个注解能够在Spring中启用组件扫描。默认会扫描与配置类相同的包。会扫描这个包以及这个包下的所有子包，查找带有@Component注解的类。



XML方式

```java
<context:component-scan base-package="soundsystem"/>
```



### 高级装配

#### 3.5 运行时值注入

当我们讨论依赖注入的时候，我们通常所讨论的是将一个bean引用注入到另一个bean的属性或构造器参数中。它通常来讲指的是将一个对象与另一个对象进行关联。

但是bean装配的另外一个方面指的是将一个值注入到bean的属性或者构造器参数中。





